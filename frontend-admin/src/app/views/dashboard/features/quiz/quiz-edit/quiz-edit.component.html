<c-modal-header>
  <h5 cModalTitle>Edit</h5>
</c-modal-header>
<c-modal-body>
  <form [formGroup]="form" novalidate (submit)="onSave()">
    <div class="form-group">
      <label cLabel>Title</label>
      <input cFormControl name="title" formControlName="title" />
      <div *ngIf="formControl['title'].errors">
        <c-form-feedback class="d-block" *ngIf="formControl['title'].errors['required'] && formControl['title'].touched"
          [valid]="false">
          Title is required.
        </c-form-feedback>
      </div>
      <c-form-feedback class="d-block" *ngIf="validationErrors['title']" [valid]="false">
        {{ validationErrors['title'] }}
      </c-form-feedback>
    </div>
    <div class="form-group">
      <label cLabel>Duration Time</label>
      <input cFormControl name="duration_time" formControlName="duration_time" type="number" />
      <div *ngIf="formControl['duration_time'].errors">
        <c-form-feedback class="d-block"
          *ngIf="formControl['duration_time'].errors['required'] && formControl['duration_time'].touched"
          [valid]="false">
          Duration Time is required.
        </c-form-feedback>
      </div>
      <c-form-feedback class="d-block" *ngIf="validationErrors['duration_time']" [valid]="false">
        {{ validationErrors['duration_time'] }}
      </c-form-feedback>
    </div>
    <div class="form-group">
      <label cLabel for="exam">Exam</label>
      <app-filterable-multiselect formControlName="exam" [idField]="'id'" [textField]="'id'"
        [textFieldDef]="getExamFilterTextField" [allowSearchFilter]="true" [allowRemoteDataSearch]="true"
        [multiple]="false" [filterMethod]="fetchFilterExam"></app-filterable-multiselect>
      <div *ngIf="formControl['exam'].errors">
        <c-form-feedback class="d-block" *ngIf="formControl['exam'].errors['required'] && formControl['exam'].touched"
          [valid]="false">
          Exam is required.
        </c-form-feedback>
      </div>
      <c-form-feedback class="d-block" *ngIf="validationErrors['exam']" [valid]="false">
        {{ validationErrors['exam'] }}
      </c-form-feedback>
    </div>
    <button type="submit" cButton color="primary" [disabled]="form.invalid" class="mt-5">
      Save
    </button>
  </form>
  <hr class="my-6" />
  <form [formGroup]="questionForm" novalidate *ngIf="editInstance !== null">
    <div class="form-group">
      <label cLabel="">Prompt</label>
      <c-row>
        <c-col>
          <input cFormControl class="form-control" name="prompt" formControlName="prompt" />
        </c-col>
        <c-col>
          <button type="button" cButton color="primary" (click)="onNewQuestionClick()">New Question</button>
        </c-col>
      </c-row>
      <div *ngIf="questionFormControl['prompt'].errors">
        <c-form-feedback class="d-block"
          *ngIf="questionFormControl['prompt'].errors['required'] && questionFormControl['prompt'].touched"
          [valid]="false">
          Prompt is required.
        </c-form-feedback>
      </div>
    </div>
    <div class="mt-3" formArrayName="answers">
      <div class="form-group" *ngFor="let answer of getQuestionAnswerForms()['controls']; let i = index">
        <label cLabel>Answer</label>
        <div [formGroupName]="i">
          <label for="answerContent{{ i }}" cLabel="col">Content</label>
          <c-row>
            <c-col>
              <input type="text" cFormControl [id]="'answerContent' + i" formControlName="content">
            </c-col>
            <c-col c-form-check>
              <input type="checkbox" cFormCheckInput [id]="'correctAnswer' + i" formControlName="correct">
              <label for="correctAnswer{{ i }}" cFormCheckLabel>Correct</label>
            </c-col>
            <c-col>
              <button type="button" cButton color="danger" (click)="onRemoveQuestionAnswer(i)">Remove</button>
            </c-col>
          </c-row>
        </div>
      </div>
    </div>
    <div class="form-group mt-3">
      <button cButton color="default" type="button" class="mr-4" (click)="addAnswer()">
        Add Answer
      </button>
      <button cButton color="primary" type="button" (click)="onQuestionSave()" [disabled]="questionForm.invalid">
        Save Question
      </button>
    </div>
    <hr class="my-6" />
    <div>
      <app-smart-table [data]="editInstance.questions || []" [columns]="columns"
        [totalPages]="editInstance.questions_count" (pageSizeChanged)="onPageSizeChange($event)"
        (pageChanged)="onPageChange($event)" (deleteOpened)="onDeleteQuestion($event)"
        (editOpened)="onEditQuestionOpen($event)"></app-smart-table>
    </div>
  </form>

</c-modal-body>
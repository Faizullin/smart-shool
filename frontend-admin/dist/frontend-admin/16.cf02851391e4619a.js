"use strict";(self.webpackChunkfrontend_admin=self.webpackChunkfrontend_admin||[]).push([[16],{9016:(x,f,l)=>{l.r(f),l.d(f,{ResultModule:()=>N});var u=l(177),g=l(4662),i=l(4703),p=l(779),k=l(4559),m=l(6354),F=l(8372),h=l(2583),t=l(7705),b=l(4858);const C=["lineChart"];let I=(()=>{class n extends h.H{constructor(){super(...arguments),this.x_time=[],this.chartLineOptions={maintainAspectRatio:!1},this.chartLineData={labels:[...this.x_time].slice(0,7),datasets:[{label:"Practical Score",backgroundColor:"rgba(220, 220, 220, 0.2)",borderColor:"rgba(220, 220, 220, 1)",pointBackgroundColor:"rgba(220, 220, 220, 1)",pointBorderColor:"#fff",data:[]},{label:"Theory Score",backgroundColor:"rgba(151, 187, 205, 0.2)",borderColor:"rgba(151, 187, 205, 1)",pointBackgroundColor:"rgba(151, 187, 205, 1)",pointBorderColor:"#fff",data:[]},{label:"Total Score",backgroundColor:"rgba(0, 0, 0, 0.2)",borderColor:"rgba(0, 0, 0, 1)",pointBackgroundColor:"rgba(255, 0, 0, 1)",pointBorderColor:"#fff",data:[]}]},this.action_urls={detail:e=>void 0===e?"/api/s/results/stats/":`/api/s/results/stats/?student_id=${e}`},this.editInstance=null}update_chart_data(e){const a=[],s={practical_score:[],theory_score:[],total_score:[]};if(void 0!==e)for(let o=0;o<e.length;o++){const d=e[o];a.push(d.date),s.practical_score.push(d.practical_score),s.theory_score.push(d.theory_score),s.total_score.push(d.total_score)}this.chartLineData.labels=a,this.chartLineData.datasets[0].data=s.practical_score,this.chartLineData.datasets[1].data=s.theory_score,this.chartLineData.datasets[2].data=s.total_score,this.lineChart.chartUpdate()}ngOnInit(){this.fetchInstance(this.modalService.config.initialState.id)}fetchInstance(e){const a=null!==this.editInstance?this.editInstance.id:e;return this.loading.list=!0,this.fetchInstanceRequest(a).subscribe({next:s=>{this.loading.list=!1,s.current_student&&(this.editInstance=s.current_student),this.update_chart_data(s.chart_data?.results_data)}})}static{this.\u0275fac=function(){let e;return function(s){return(e||(e=t.xGo(n)))(s||n)}}()}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-result-stats"]],viewQuery:function(a,s){if(1&a&&t.GBs(C,5),2&a){let o;t.mGM(o=t.lsd())&&(s.lineChart=o.first)}},features:[t.Vt3],decls:12,vars:5,consts:[["cModalTitle",""],["xs","12","lg","8"],[1,"mb-4"],["type","line",3,"data","options"],["lineChart",""]],template:function(a,s){1&a&&(t.j41(0,"c-modal-header")(1,"h5",0),t.EFF(2),t.k0s()(),t.j41(3,"c-modal-body")(4,"c-row")(5,"c-col",1)(6,"c-card",2)(7,"c-card-header"),t.EFF(8," Results Chart "),t.k0s(),t.j41(9,"c-card-body"),t.nrm(10,"c-chart",3,4),t.k0s()()()()()),2&a&&(t.R7$(2),t.E5c("Student #",null==s.editInstance?null:s.editInstance.id," ",null==s.editInstance||null==s.editInstance.user?null:s.editInstance.user.username,"(",null==s.editInstance||null==s.editInstance.user?null:s.editInstance.user.email,") "),t.R7$(8),t.Y8G("data",s.chartLineData)("options",s.chartLineOptions))},dependencies:[i.iby,i.qHy,i.lMi,i.gLf,i.oMR,i.Jyz,i.epl,i.L$K,b.j]})}}return n})();var r=l(4341),v=l(7541);function R(n,c){if(1&n&&(t.j41(0,"c-form-feedback",12),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.Y8G("valid",!1),t.R7$(1),t.SpI(" ",e.validationErrors.content," ")}}function _(n,c){if(1&n&&(t.j41(0,"c-form-feedback",12),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.Y8G("valid",!1),t.R7$(1),t.JRh(e.validationErrors.result_id)}}function y(n,c){if(1&n&&(t.j41(0,"div",13)(1,"span",14),t.EFF(2),t.k0s(),t.j41(3,"span",14),t.EFF(4),t.k0s()()),2&n){const e=t.XpG();t.R7$(2),t.JRh(null==e.editInstance?null:e.editInstance.created_at),t.R7$(2),t.JRh(null==e.editInstance?null:e.editInstance.updated_at)}}let E=(()=>{class n extends h.H{constructor(){super(...arguments),this.action_urls={detail:e=>`/api/s/feedbacks/${e}/`,post:()=>"/api/s/feedbacks/",delete:e=>`/api/s/feedbacks/${e}/`},this.editInstance=null,this.fetchFilterRequest={results:e=>this.http.get("/api/s/results/",{params:{...e}}).pipe((0,m.T)(a=>a.results||[]))}}ngOnInit(){this.form=this.fb.group({content:["",r.k0.required],result:[[],r.k0.required]});const e=this.modalService.config.initialState;e.id?this.fetchInstance(e.id):this.patchFormValue()}paraphraseFeedback(){const a="Paraphrase this content: "+this.form.get("content")?.value;this.http.post("/api/s/feedbacks/paraphrase",{prompt:a}).subscribe({next:s=>{this.form.patchValue({content:s.data})}})}patchFormValue(e){if(null!==this.editInstance)this.form.patchValue({content:this.editInstance.content,result:this.editInstance.result?[this.editInstance.result]:[]});else{const a=this.modalService.config.initialState;this.form.patchValue({content:"",result:a?.initial_data?.result_instance?[a.initial_data?.result_instance]:[]})}}getPreparedEditData(e){return e.result_id=e.result?.length>0?e.result[0].id:null,{...e}}getResultFilterTextField(e){return`${e?.id} - ${e?.student?.user?.username}`}afterRequestError(e){500==e.status&&alert("Error 500: comething went wrong!"),super.afterRequestError(e)}onFeedbackDelete(){null!==this.editInstance&&(this.loading.post=!0,this.http.delete(this.action_urls.delete(this.editInstance.id)).subscribe({next:e=>{this.editInstance=null,this.form.reset(),this.loading.post=!1},error:e=>{this.loading.post=!1}}))}static{this.\u0275fac=function(){let e;return function(s){return(e||(e=t.xGo(n)))(s||n)}}()}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-feedback-edit"]],features:[t.Vt3],decls:21,vars:13,consts:[["cModalTitle",""],["novalidate","",3,"formGroup","ngSubmit"],[1,"form-group","mb-3"],["cLabel","","for","content"],["cFormControl","","formControlName","content","id","content","type","text"],["class","d-block",3,"valid",4,"ngIf"],[1,"mt-4"],["cLabel","","for","result"],["formControlName","result","id","result",3,"idField","textFieldDef","allowRemoteDataSearch","useInitialLoad","multiple","filterMethod"],["class","mb-3",4,"ngIf"],["cButton","","color","primary","type","submit",3,"disabled"],["cButton","","color","danger","type","button",3,"disabled","click"],[1,"d-block",3,"valid"],[1,"mb-3"],["cCardText",""]],template:function(a,s){1&a&&(t.j41(0,"c-modal-header")(1,"h5",0),t.EFF(2),t.k0s()(),t.j41(3,"c-modal-body")(4,"form",1),t.bIt("ngSubmit",function(){return s.onSave()}),t.j41(5,"div",2)(6,"label",3),t.EFF(7,"Content"),t.k0s(),t.nrm(8,"textarea",4),t.DNE(9,R,2,2,"c-form-feedback",5),t.nrm(10,"div",6),t.k0s(),t.j41(11,"div",2)(12,"label",7),t.EFF(13,"Result"),t.k0s(),t.nrm(14,"app-filterable-multiselect",8),t.DNE(15,_,2,2,"c-form-feedback",5),t.k0s(),t.DNE(16,y,5,2,"div",9),t.j41(17,"button",10),t.EFF(18,"Save"),t.k0s(),t.j41(19,"button",11),t.bIt("click",function(){return s.onFeedbackDelete()}),t.EFF(20,"Delete"),t.k0s()()()),2&a&&(t.R7$(2),t.SpI("Feedback #",null==s.editInstance?null:s.editInstance.id,""),t.R7$(2),t.Y8G("formGroup",s.form),t.R7$(5),t.Y8G("ngIf",s.validationErrors.content),t.R7$(5),t.Y8G("idField","id")("textFieldDef",s.getResultFilterTextField)("allowRemoteDataSearch",!0)("useInitialLoad",!0)("multiple",!1)("filterMethod",s.fetchFilterRequest.results),t.R7$(1),t.Y8G("ngIf",s.validationErrors.result_id),t.R7$(1),t.Y8G("ngIf",void 0!==s.editInstance),t.R7$(1),t.Y8G("disabled",s.loading.post),t.R7$(2),t.Y8G("disabled",s.loading.post))},dependencies:[i.FaW,u.bT,r.qT,r.me,r.BC,r.cb,r.j4,r.JD,i._fv,i.l_X,i.XW7,i.YJZ,i.Jyz,i.epl,i.L$K,v.D]})}}return n})();var S=l(1626),$=l(1708);function j(n,c){if(1&n){const e=t.RV6();t.j41(0,"td")(1,"button",4),t.bIt("click",function(){const o=t.eBV(e).$implicit,d=t.XpG();return t.Njj(d.onEditFeedback(o))}),t.EFF(2),t.k0s()()}if(2&n){const e=c.$implicit;t.R7$(2),t.SpI(" ",e.feedback&&null!=e.feedback&&e.feedback.id?"Edit feedback #"+(null==e.feedback?null:e.feedback.id):"Create feedback"," ")}}function D(n,c){if(1&n){const e=t.RV6();t.j41(0,"button",4),t.bIt("click",function(){t.eBV(e);const s=t.XpG().$implicit,o=t.XpG();return t.Njj(o.onStatsOpenClick(s.student.id))}),t.EFF(1," See student stats "),t.k0s()}}function G(n,c){if(1&n&&(t.j41(0,"td"),t.DNE(1,D,2,0,"button",5),t.k0s()),2&n){const e=c.$implicit;t.R7$(1),t.Y8G("ngIf",e.student)}}let T=(()=>{class n{constructor(e,a){this.http=e,this.modalService=a,this.table_title="Results",this.actions={list:{use:!0,url:()=>"/api/s/results/"},edit:{use:!0,component:F.J},delete:{use:!0,url:s=>`/api/s/results/${s}/`}},this.columns=[{header:"Id",field:"id",sortable:!0,filter:{type:"text"}},{header:"Total Score",field:"total_score",sortable:!0,filter:{type:"text"}},{header:"Checked",field:"checked",filter:{type:"select",fetch:{data:[{label:"Checked",value:"true"},{label:"Not Checked",value:"false"}]}}},{header:"Attendance",field:"attendance",filter:{type:"select",fetch:{data:[{label:"Attended",value:"true"},{label:"Absent",value:"false"}]}},render:s=>s.attendance?"Attended":"Absent"},{header:"Student",field:"student",filter:{type:"text"},render:s=>s.student?.user?.username||""},{header:"Subject Group",field:"subject_group",filter:{type:"select",fetch:{useInitital:!0,action:()=>this.http.get("/api/s/subject-groups").pipe((0,m.T)(s=>s.results||[])),value_field:"id",label_field:"title"}},render:s=>s.student?.current_group?.title||""},{header:"Updated At",field:"updated_at",sortable:!0,filter:{type:"date"}},{header:"Feedback Actions",field:"feedback_actions"},{header:"Student stats",field:"stats"}]}onEditFeedback(e){const a={};e.feedback?.id?a.id=e.feedback?.id:a.initial_data={result_instance:e},this.bsModalRef=this.modalService.show(E,{initialState:a,class:"modal-lg"})}onStatsOpenClick(e){const a={};void 0!==e&&(a.id=e),this.bsModalRef=this.modalService.show(I,{initialState:a,class:"modal-lg"})}static{this.\u0275fac=function(a){return new(a||n)(t.rXU(S.Qq),t.rXU(p.I8))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-result-list"]],decls:5,vars:3,consts:[[3,"title","actions","columns"],["columnDef","feedback_actions"],["headerCellDef",""],["columnDef","stats"],["cButton","","type","button","color","secondary",3,"click"],["cButton","","type","button","color","secondary",3,"click",4,"ngIf"]],template:function(a,s){1&a&&(t.j41(0,"dashboard-base-list",0),t.DNE(1,j,3,1,"ng-template",1,2,t.C5r),t.DNE(3,G,2,1,"ng-template",3,2,t.C5r),t.k0s()),2&a&&t.Y8G("title",s.table_title)("actions",s.actions)("columns",s.columns)},dependencies:[u.bT,i._fv,$.p]})}}return n})();var L=l(337),B=l(9304),V=l(1445),Y=l(712);const M=[{path:"list",component:T,data:{title:$localize`Results`}}];let N=(()=>{class n{static{this.\u0275fac=function(a){return new(a||n)}}static{this.\u0275mod=t.$C({type:n})}static{this.\u0275inj=t.G2t({imports:[i.Dw2,g.op,i.jr_,u.MD,i.pc9,i.Emn,i.tmq,i.tmq,i.mCO,V.WidgetsModule,i.Q_q,i.tHK,r.YN,r.X1,p.Q_.forRoot(),L.K,B.I,k.iI.forChild(M),b.u,i.Dw2,i.pc9,i.EJq,Y.W]})}}return n})()}}]);
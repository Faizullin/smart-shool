"use strict";(self.webpackChunkfrontend_admin=self.webpackChunkfrontend_admin||[]).push([[63],{1063:(U,m,l)=>{l.r(m),l.d(m,{ExamModule:()=>Q});var d=l(177),_=l(4662),i=l(4703),u=l(779),E=l(4559),x=l(337),v=l(9304),r=l(4341),p=l(4858),f=l(6354),F=l(9873),h=l(2583),t=l(7705),g=l(7541);function y(a,o){if(1&a&&(t.j41(0,"c-form-feedback",9),t.EFF(1),t.k0s()),2&a){const e=t.XpG();t.Y8G("valid",!1),t.R7$(1),t.JRh(e.validationErrors.exam_type)}}function C(a,o){if(1&a&&(t.j41(0,"c-form-feedback",9),t.EFF(1),t.k0s()),2&a){const e=t.XpG();t.Y8G("valid",!1),t.R7$(1),t.JRh(e.validationErrors.subject_id)}}let b=(()=>{class a extends h.H{constructor(){super(...arguments),this.action_urls={detail:e=>`/api/s/exams/${e}/`,post:()=>"/api/s/exams/"},this.editInstance=null,this.exam_types=[{value:"i",label:"Initial"},{value:"m",label:"Mid-term"},{value:"f",label:"Final"}],this.fetchFilterRequest={subjects:e=>this.http.get("/api/s/subjects/",{params:{...e}}).pipe((0,f.T)(s=>s.results||[]))}}ngOnInit(){const e=this.modalService.config.initialState;this.form=this.fb.group({exam_type:[],subjects:[[]]}),e.id&&this.fetchInstance(e.id)}patchFormValue(e){if(null!==this.editInstance){const s=this.exam_types.find(n=>n.value===this.editInstance?.exam_type);this.form.patchValue({exam_type:void 0!==s?[s]:null,subjects:this.editInstance.subject?[this.editInstance.subject]:[]})}}onSave(){if(this.form.valid){const e=this.form.value;e.subject_id=e.subjects.length>0?e.subjects[0].id:null,e.exam_type=e.exam_type.length>0?e.exam_type[0].value:null,this.fetchSave(e)}}static{this.\u0275fac=function(){let e;return function(n){return(e||(e=t.xGo(a)))(n||a)}}()}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-exam-edit"]],features:[t.Vt3],decls:17,vars:16,consts:[["cModalTitle",""],["novalidate","",3,"formGroup","ngSubmit"],[1,"form-group","mb-3"],["cLabel","","for","exam_type"],["formControlName","exam_type","id","exam_type",3,"idField","textField","current_filters","allowRemoteDataSearch","multiple","useInitialLoad"],["class","d-block",3,"valid",4,"ngIf"],["cLabel","","for","subjects"],["formControlName","subjects","id","subjects",3,"idField","textField","allowRemoteDataSearch","filterMethod","useInitialLoad","multiple"],["cButton","","color","primary","type","submit"],[1,"d-block",3,"valid"]],template:function(s,n){1&s&&(t.j41(0,"c-modal-header")(1,"h5",0),t.EFF(2),t.k0s()(),t.j41(3,"c-modal-body")(4,"form",1),t.bIt("ngSubmit",function(){return n.onSave()}),t.j41(5,"div",2)(6,"label",3),t.EFF(7,"Exam Type"),t.k0s(),t.nrm(8,"app-filterable-multiselect",4),t.DNE(9,y,2,2,"c-form-feedback",5),t.k0s(),t.j41(10,"div",2)(11,"label",6),t.EFF(12,"Subject"),t.k0s(),t.nrm(13,"app-filterable-multiselect",7),t.DNE(14,C,2,2,"c-form-feedback",5),t.k0s(),t.j41(15,"button",8),t.EFF(16,"Save"),t.k0s()()()),2&s&&(t.R7$(2),t.SpI("Exam #",null==n.editInstance?null:n.editInstance.id,""),t.R7$(2),t.Y8G("formGroup",n.form),t.R7$(4),t.Y8G("idField","value")("textField","label")("current_filters",n.exam_types)("allowRemoteDataSearch",!1)("multiple",!1)("useInitialLoad",!1),t.R7$(1),t.Y8G("ngIf",n.validationErrors.exam_type),t.R7$(4),t.Y8G("idField","id")("textField","title")("allowRemoteDataSearch",!0)("filterMethod",n.fetchFilterRequest.subjects)("useInitialLoad",!0)("multiple",!1),t.R7$(1),t.Y8G("ngIf",n.validationErrors.subject_id))},dependencies:[d.bT,i._fv,i.Jyz,i.epl,i.L$K,i.XW7,i.YJZ,r.qT,r.BC,r.cb,r.j4,r.JD,g.D]})}}return a})();var j=l(627);const I=["attendanceChart"];function S(a,o){1&a&&(t.j41(0,"div",12),t.EFF(1,"Data is not available or empty!"),t.k0s())}function R(a,o){if(1&a&&(t.j41(0,"td"),t.EFF(1),t.k0s()),2&a){const e=o.$implicit;t.R7$(1),t.JRh(e.id)}}function D(a,o){if(1&a&&(t.j41(0,"td"),t.EFF(1),t.k0s()),2&a){const e=o.$implicit;t.R7$(1),t.JRh(e.theory_score)}}function $(a,o){if(1&a&&(t.j41(0,"td"),t.EFF(1),t.k0s()),2&a){const e=o.$implicit;t.R7$(1),t.JRh(e.total_score)}}function T(a,o){if(1&a&&(t.j41(0,"td"),t.EFF(1),t.k0s()),2&a){const e=o.$implicit;t.R7$(1),t.JRh(e.student?e.student.user.email:"")}}const k=function(){return{create:!1,delete:!1,edit:!1}};let G=(()=>{class a extends h.H{constructor(){super(...arguments),this.table_data=[],this.attendanceChartOptions={maintainAspectRatio:!1},this.attendanceChartData={labels:["Absent","Passed","Failed to pass"],datasets:[{backgroundColor:["#808080","#00D8FF","#E46651"],data:[0,0,0]}]},this.unavailable_data=!1,this.action_urls={detail:e=>`/api/s/exams/stats/?exam_id=${e}`},this.editInstance=null}update_chart_data(e){const s={absent_count:e?.absent_count||0,passed_count:e?.passed_count||0,failed_count:e?.failed_count||0};this.attendanceChartData.datasets[0].data=[s.absent_count,s.passed_count,s.failed_count],this.unavailable_data=0===s.passed_count&&0===s.failed_count&&0===s.passed_count,this.attendanceChart.chartUpdate()}fetchInstance(e){const s=null!==this.editInstance?this.editInstance.id:e;return this.loading.list=!0,this.fetchInstanceRequest(s).subscribe({next:n=>{this.loading.list=!1,this.update_chart_data(n.chart_data?.attendance_data),n.table_data&&(this.table_data=n.table_data)}})}static{this.\u0275fac=function(){let e;return function(n){return(e||(e=t.xGo(a)))(n||a)}}()}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-exam-stats"]],viewQuery:function(s,n){if(1&s&&t.GBs(I,5),2&s){let c;t.mGM(c=t.lsd())&&(n.attendanceChart=c.first)}},features:[t.Vt3],decls:26,vars:10,consts:[["cModalTitle",""],["xs","12","lg","8"],[1,"mb-4"],["type","doughnut",3,"data","options"],["attendanceChart",""],["class","alert alert-danger",4,"ngIf"],[3,"data","page","useActions","useSearchFilters","usePagination"],["columnDef","id","columnLabel","Id.","sortable","True"],["headerCellDef",""],["columnDef","theory_score","columnLabel","Theory Score.","sortable","true"],["columnDef","total_score","columnLabel","Total Score.","sortable","true"],["columnDef","student","columnLabel","Student.","sortable","true"],[1,"alert","alert-danger"]],template:function(s,n){1&s&&(t.j41(0,"c-modal-header")(1,"h5",0),t.EFF(2),t.k0s()(),t.j41(3,"c-modal-body")(4,"c-row")(5,"c-col",1)(6,"c-card",2)(7,"c-card-header"),t.EFF(8," Exam Chart "),t.k0s(),t.j41(9,"c-card-body"),t.nrm(10,"c-chart",3,4),t.DNE(12,S,2,0,"div",5),t.k0s()(),t.j41(13,"c-card",2)(14,"c-card-header"),t.EFF(15," Exam Data "),t.k0s(),t.j41(16,"c-card-body")(17,"app-smart-table1",6),t.DNE(18,R,2,1,"ng-template",7,8,t.C5r),t.DNE(20,D,2,1,"ng-template",9,8,t.C5r),t.DNE(22,$,2,1,"ng-template",10,8,t.C5r),t.DNE(24,T,2,1,"ng-template",11,8,t.C5r),t.k0s()()()()()()),2&s&&(t.R7$(2),t.SpI("Exam #",null==n.editInstance?null:n.editInstance.id," "),t.R7$(8),t.Y8G("data",n.attendanceChartData)("options",n.attendanceChartOptions),t.R7$(2),t.Y8G("ngIf",n.unavailable_data),t.R7$(5),t.Y8G("data",n.table_data)("page",1)("useActions",t.lJ4(9,k))("useSearchFilters",!1)("usePagination",!1))},dependencies:[i.iby,i.qHy,i.lMi,d.bT,i.gLf,i.oMR,i.Jyz,i.epl,i.L$K,j.M,p.j]})}}return a})();var L=l(1626),z=l(1708);function N(a,o){if(1&a){const e=t.RV6();t.j41(0,"button",5),t.bIt("click",function(){t.eBV(e);const n=t.XpG().$implicit,c=t.XpG();return t.Njj(c.onEditQuiz(n))}),t.EFF(1),t.k0s()}if(2&a){const e=t.XpG().$implicit;t.R7$(1),t.SpI(" Edit Quiz #",e.quiz.id," ")}}function M(a,o){if(1&a){const e=t.RV6();t.j41(0,"button",5),t.bIt("click",function(){t.eBV(e);const n=t.XpG().$implicit,c=t.XpG();return t.Njj(c.onEditQuiz(n))}),t.EFF(1," Create Quiz "),t.k0s()}}function Y(a,o){if(1&a&&(t.j41(0,"td"),t.DNE(1,N,2,1,"button",4),t.DNE(2,M,2,0,"button",4),t.k0s()),2&a){const e=o.$implicit;t.R7$(1),t.Y8G("ngIf",e.quiz),t.R7$(1),t.Y8G("ngIf",!e.quiz)}}function B(a,o){if(1&a){const e=t.RV6();t.j41(0,"td")(1,"button",6),t.bIt("click",function(){const c=t.eBV(e).$implicit,O=t.XpG();return t.Njj(O.onStatsOpenClick(c.id))}),t.EFF(2," See exam stats "),t.k0s()()}}let V=(()=>{class a{constructor(e,s){this.http=e,this.modalService=s,this.table_title="Exams",this.actions={list:{use:!0,url:()=>"/api/s/exams/"},edit:{use:!0,component:b},delete:{use:!0,url:n=>`/api/s/exams/${n}/`},create:{use:!0,component:b}},this.columns=[{header:"Id",field:"id",sortable:!0,filter:{type:"text"}},{header:"Exam Type",field:"exam_type",filter:{type:"select",fetch:{data:[{label:"Initital",value:"i"},{label:"Mid",value:"m"},{label:"Final",value:"f"}]}}},{header:"Subject",field:"subject",filter:{type:"select",fetch:{useInitital:!0,action:()=>this.http.get("/api/s/subjects").pipe((0,f.T)(n=>n.results||[])),value_field:"id",label_field:"title"}},render:n=>n.subject.title},{header:"Quiz",field:"quiz"},{header:"Student stats",field:"stats"}]}onEditQuiz(e){const s={};void 0!==e&&e.quiz&&(s.id=e.quiz.id),this.bsModalRef=this.modalService.show(F.D,{initialState:s,class:"modal-lg"})}onStatsOpenClick(e){const s={};void 0!==e&&(s.id=e),this.bsModalRef=this.modalService.show(G,{initialState:s,class:"modal-lg"})}static{this.\u0275fac=function(s){return new(s||a)(t.rXU(L.Qq),t.rXU(u.I8))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["dashboard-exam-list"]],decls:5,vars:3,consts:[[3,"title","actions","columns"],["columnDef","quiz"],["headerCellDef",""],["columnDef","stats","columnLabel","Student Stats.","sortable","false"],["cButton","","type","button","color","primary",3,"click",4,"ngIf"],["cButton","","type","button","color","primary",3,"click"],["cButton","","type","button","color","secondary",3,"click"]],template:function(s,n){1&s&&(t.j41(0,"dashboard-base-list",0),t.DNE(1,Y,3,2,"ng-template",1,2,t.C5r),t.DNE(3,B,3,0,"ng-template",3,2,t.C5r),t.k0s()),2&s&&t.Y8G("title",n.table_title)("actions",n.actions)("columns",n.columns)},dependencies:[d.bT,i._fv,z.p]})}}return a})();var J=l(712);const X=[{path:"list",component:V,data:{title:$localize`Exams`}}];let Q=(()=>{class a{static{this.\u0275fac=function(s){return new(s||a)}}static{this.\u0275mod=t.$C({type:a})}static{this.\u0275inj=t.G2t({imports:[i.Dw2,_.op,i.jr_,d.MD,i.pc9,i.Emn,i.tmq,i.tmq,i.mCO,i.Q_q,i.tHK,r.YN,r.X1,u.Q_.forRoot(),x.K,v.I,E.iI.forChild(X),p.u,i.Dw2,i.pc9,i.EJq,J.W]})}}return a})()}}]);
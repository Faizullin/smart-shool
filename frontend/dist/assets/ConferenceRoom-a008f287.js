var zr=Object.defineProperty;var Jr=(t,e,r)=>e in t?zr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var $=(t,e,r)=>(Jr(t,typeof e!="symbol"?e+"":e,r),r);import{c as re,r as tr,g as Xr,R as Te,j as x,I as X,m as Zr,i as te,k as Qr,l as en,n as tn,p as rn,q as nn,s as sn,F as Nt,t as on,v as an,w as un,x as ln,y as fn,o as cn,b as hn,e as dn,z as pn,d as Mt,P as gn,h as yn,B as _n,C as wn,T as mn,L as bn}from"./index-d77087e3.js";import{C as En}from"./ChatMessageItemCard-5138d241.js";/* empty css                  */var it={exports:{}},Pe,Bt;function Rn(){if(Bt)return Pe;Bt=1;var t=1e3,e=t*60,r=e*60,s=r*24,a=s*7,f=s*365.25;Pe=function(g,y){y=y||{};var E=typeof g;if(E==="string"&&g.length>0)return c(g);if(E==="number"&&isFinite(g))return y.long?w(g):l(g);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(g))};function c(g){if(g=String(g),!(g.length>100)){var y=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(g);if(y){var E=parseFloat(y[1]),C=(y[2]||"ms").toLowerCase();switch(C){case"years":case"year":case"yrs":case"yr":case"y":return E*f;case"weeks":case"week":case"w":return E*a;case"days":case"day":case"d":return E*s;case"hours":case"hour":case"hrs":case"hr":case"h":return E*r;case"minutes":case"minute":case"mins":case"min":case"m":return E*e;case"seconds":case"second":case"secs":case"sec":case"s":return E*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return E;default:return}}}}function l(g){var y=Math.abs(g);return y>=s?Math.round(g/s)+"d":y>=r?Math.round(g/r)+"h":y>=e?Math.round(g/e)+"m":y>=t?Math.round(g/t)+"s":g+"ms"}function w(g){var y=Math.abs(g);return y>=s?m(g,y,s,"day"):y>=r?m(g,y,r,"hour"):y>=e?m(g,y,e,"minute"):y>=t?m(g,y,t,"second"):g+" ms"}function m(g,y,E,C){var R=y>=E*1.5;return Math.round(g/E)+" "+C+(R?"s":"")}return Pe}function vn(t){r.debug=r,r.default=r,r.coerce=w,r.disable=f,r.enable=a,r.enabled=c,r.humanize=Rn(),r.destroy=m,Object.keys(t).forEach(g=>{r[g]=t[g]}),r.names=[],r.skips=[],r.formatters={};function e(g){let y=0;for(let E=0;E<g.length;E++)y=(y<<5)-y+g.charCodeAt(E),y|=0;return r.colors[Math.abs(y)%r.colors.length]}r.selectColor=e;function r(g){let y,E=null,C,R;function v(...T){if(!v.enabled)return;const d=v,b=Number(new Date),S=b-(y||b);d.diff=S,d.prev=y,d.curr=b,y=b,T[0]=r.coerce(T[0]),typeof T[0]!="string"&&T.unshift("%O");let A=0;T[0]=T[0].replace(/%([a-zA-Z%])/g,(q,G)=>{if(q==="%%")return"%";A++;const J=r.formatters[G];if(typeof J=="function"){const ke=T[A];q=J.call(d,ke),T.splice(A,1),A--}return q}),r.formatArgs.call(d,T),(d.log||r.log).apply(d,T)}return v.namespace=g,v.useColors=r.useColors(),v.color=r.selectColor(g),v.extend=s,v.destroy=r.destroy,Object.defineProperty(v,"enabled",{enumerable:!0,configurable:!1,get:()=>E!==null?E:(C!==r.namespaces&&(C=r.namespaces,R=r.enabled(g)),R),set:T=>{E=T}}),typeof r.init=="function"&&r.init(v),v}function s(g,y){const E=r(this.namespace+(typeof y>"u"?":":y)+g);return E.log=this.log,E}function a(g){r.save(g),r.namespaces=g,r.names=[],r.skips=[];let y;const E=(typeof g=="string"?g:"").split(/[\s,]+/),C=E.length;for(y=0;y<C;y++)E[y]&&(g=E[y].replace(/\*/g,".*?"),g[0]==="-"?r.skips.push(new RegExp("^"+g.slice(1)+"$")):r.names.push(new RegExp("^"+g+"$")))}function f(){const g=[...r.names.map(l),...r.skips.map(l).map(y=>"-"+y)].join(",");return r.enable(""),g}function c(g){if(g[g.length-1]==="*")return!0;let y,E;for(y=0,E=r.skips.length;y<E;y++)if(r.skips[y].test(g))return!1;for(y=0,E=r.names.length;y<E;y++)if(r.names[y].test(g))return!0;return!1}function l(g){return g.toString().substring(2,g.toString().length-2).replace(/\.\*\?$/,"*")}function w(g){return g instanceof Error?g.stack||g.message:g}function m(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}var Cn=vn;(function(t,e){e.formatArgs=s,e.save=a,e.load=f,e.useColors=r,e.storage=c(),e.destroy=(()=>{let w=!1;return()=>{w||(w=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(w){if(w[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+w[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const m="color: "+this.color;w.splice(1,0,m,"color: inherit");let g=0,y=0;w[0].replace(/%[a-zA-Z%]/g,E=>{E!=="%%"&&(g++,E==="%c"&&(y=g))}),w.splice(y,0,m)}e.log=console.debug||console.log||(()=>{});function a(w){try{w?e.storage.setItem("debug",w):e.storage.removeItem("debug")}catch{}}function f(){let w;try{w=e.storage.getItem("debug")}catch{}return!w&&typeof process<"u"&&"env"in process&&(w={}.DEBUG),w}function c(){try{return localStorage}catch{}}t.exports=Cn(e);const{formatters:l}=t.exports;l.j=function(w){try{return JSON.stringify(w)}catch(m){return"[UnexpectedJSONParseError]: "+m.message}}})(it,it.exports);var Sn=it.exports,Tn=function(){if(typeof globalThis>"u")return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null},st={exports:{}},ot={exports:{}},he={},Ae={};Ae.byteLength=In;Ae.toByteArray=Mn;Ae.fromByteArray=Ln;var K=[],H=[],xn=typeof Uint8Array<"u"?Uint8Array:Array,je="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var ae=0,An=je.length;ae<An;++ae)K[ae]=je[ae],H[je.charCodeAt(ae)]=ae;H["-".charCodeAt(0)]=62;H["_".charCodeAt(0)]=63;function rr(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var s=r===e?0:4-r%4;return[r,s]}function In(t){var e=rr(t),r=e[0],s=e[1];return(r+s)*3/4-s}function Nn(t,e,r){return(e+r)*3/4-r}function Mn(t){var e,r=rr(t),s=r[0],a=r[1],f=new xn(Nn(t,s,a)),c=0,l=a>0?s-4:s,w;for(w=0;w<l;w+=4)e=H[t.charCodeAt(w)]<<18|H[t.charCodeAt(w+1)]<<12|H[t.charCodeAt(w+2)]<<6|H[t.charCodeAt(w+3)],f[c++]=e>>16&255,f[c++]=e>>8&255,f[c++]=e&255;return a===2&&(e=H[t.charCodeAt(w)]<<2|H[t.charCodeAt(w+1)]>>4,f[c++]=e&255),a===1&&(e=H[t.charCodeAt(w)]<<10|H[t.charCodeAt(w+1)]<<4|H[t.charCodeAt(w+2)]>>2,f[c++]=e>>8&255,f[c++]=e&255),f}function Bn(t){return K[t>>18&63]+K[t>>12&63]+K[t>>6&63]+K[t&63]}function Fn(t,e,r){for(var s,a=[],f=e;f<r;f+=3)s=(t[f]<<16&16711680)+(t[f+1]<<8&65280)+(t[f+2]&255),a.push(Bn(s));return a.join("")}function Ln(t){for(var e,r=t.length,s=r%3,a=[],f=16383,c=0,l=r-s;c<l;c+=f)a.push(Fn(t,c,c+f>l?l:c+f));return s===1?(e=t[r-1],a.push(K[e>>2]+K[e<<4&63]+"==")):s===2&&(e=(t[r-2]<<8)+t[r-1],a.push(K[e>>10]+K[e>>4&63]+K[e<<2&63]+"=")),a.join("")}var ht={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ht.read=function(t,e,r,s,a){var f,c,l=a*8-s-1,w=(1<<l)-1,m=w>>1,g=-7,y=r?a-1:0,E=r?-1:1,C=t[e+y];for(y+=E,f=C&(1<<-g)-1,C>>=-g,g+=l;g>0;f=f*256+t[e+y],y+=E,g-=8);for(c=f&(1<<-g)-1,f>>=-g,g+=s;g>0;c=c*256+t[e+y],y+=E,g-=8);if(f===0)f=1-m;else{if(f===w)return c?NaN:(C?-1:1)*(1/0);c=c+Math.pow(2,s),f=f-m}return(C?-1:1)*c*Math.pow(2,f-s)};ht.write=function(t,e,r,s,a,f){var c,l,w,m=f*8-a-1,g=(1<<m)-1,y=g>>1,E=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,C=s?0:f-1,R=s?1:-1,v=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,c=g):(c=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-c))<1&&(c--,w*=2),c+y>=1?e+=E/w:e+=E*Math.pow(2,1-y),e*w>=2&&(c++,w/=2),c+y>=g?(l=0,c=g):c+y>=1?(l=(e*w-1)*Math.pow(2,a),c=c+y):(l=e*Math.pow(2,y-1)*Math.pow(2,a),c=0));a>=8;t[r+C]=l&255,C+=R,l/=256,a-=8);for(c=c<<a|l,m+=a;m>0;t[r+C]=c&255,C+=R,c/=256,m-=8);t[r+C-R]|=v*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=Ae,r=ht,s=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=l,t.SlowBuffer=b,t.INSPECT_MAX_BYTES=50;const a=2147483647;t.kMaxLength=a,l.TYPED_ARRAY_SUPPORT=f(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function f(){try{const o=new Uint8Array(1),n={foo:function(){return 42}};return Object.setPrototypeOf(n,Uint8Array.prototype),Object.setPrototypeOf(o,n),o.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function c(o){if(o>a)throw new RangeError('The value "'+o+'" is invalid for option "size"');const n=new Uint8Array(o);return Object.setPrototypeOf(n,l.prototype),n}function l(o,n,i){if(typeof o=="number"){if(typeof n=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return y(o)}return w(o,n,i)}l.poolSize=8192;function w(o,n,i){if(typeof o=="string")return E(o,n);if(ArrayBuffer.isView(o))return R(o);if(o==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof o);if(Y(o,ArrayBuffer)||o&&Y(o.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Y(o,SharedArrayBuffer)||o&&Y(o.buffer,SharedArrayBuffer)))return v(o,n,i);if(typeof o=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const u=o.valueOf&&o.valueOf();if(u!=null&&u!==o)return l.from(u,n,i);const h=T(o);if(h)return h;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof o[Symbol.toPrimitive]=="function")return l.from(o[Symbol.toPrimitive]("string"),n,i);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof o)}l.from=function(o,n,i){return w(o,n,i)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array);function m(o){if(typeof o!="number")throw new TypeError('"size" argument must be of type number');if(o<0)throw new RangeError('The value "'+o+'" is invalid for option "size"')}function g(o,n,i){return m(o),o<=0?c(o):n!==void 0?typeof i=="string"?c(o).fill(n,i):c(o).fill(n):c(o)}l.alloc=function(o,n,i){return g(o,n,i)};function y(o){return m(o),c(o<0?0:d(o)|0)}l.allocUnsafe=function(o){return y(o)},l.allocUnsafeSlow=function(o){return y(o)};function E(o,n){if((typeof n!="string"||n==="")&&(n="utf8"),!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n);const i=S(o,n)|0;let u=c(i);const h=u.write(o,n);return h!==i&&(u=u.slice(0,h)),u}function C(o){const n=o.length<0?0:d(o.length)|0,i=c(n);for(let u=0;u<n;u+=1)i[u]=o[u]&255;return i}function R(o){if(Y(o,Uint8Array)){const n=new Uint8Array(o);return v(n.buffer,n.byteOffset,n.byteLength)}return C(o)}function v(o,n,i){if(n<0||o.byteLength<n)throw new RangeError('"offset" is outside of buffer bounds');if(o.byteLength<n+(i||0))throw new RangeError('"length" is outside of buffer bounds');let u;return n===void 0&&i===void 0?u=new Uint8Array(o):i===void 0?u=new Uint8Array(o,n):u=new Uint8Array(o,n,i),Object.setPrototypeOf(u,l.prototype),u}function T(o){if(l.isBuffer(o)){const n=d(o.length)|0,i=c(n);return i.length===0||o.copy(i,0,0,n),i}if(o.length!==void 0)return typeof o.length!="number"||Ue(o.length)?c(0):C(o);if(o.type==="Buffer"&&Array.isArray(o.data))return C(o.data)}function d(o){if(o>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return o|0}function b(o){return+o!=o&&(o=0),l.alloc(+o)}l.isBuffer=function(n){return n!=null&&n._isBuffer===!0&&n!==l.prototype},l.compare=function(n,i){if(Y(n,Uint8Array)&&(n=l.from(n,n.offset,n.byteLength)),Y(i,Uint8Array)&&(i=l.from(i,i.offset,i.byteLength)),!l.isBuffer(n)||!l.isBuffer(i))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(n===i)return 0;let u=n.length,h=i.length;for(let p=0,_=Math.min(u,h);p<_;++p)if(n[p]!==i[p]){u=n[p],h=i[p];break}return u<h?-1:h<u?1:0},l.isEncoding=function(n){switch(String(n).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(n,i){if(!Array.isArray(n))throw new TypeError('"list" argument must be an Array of Buffers');if(n.length===0)return l.alloc(0);let u;if(i===void 0)for(i=0,u=0;u<n.length;++u)i+=n[u].length;const h=l.allocUnsafe(i);let p=0;for(u=0;u<n.length;++u){let _=n[u];if(Y(_,Uint8Array))p+_.length>h.length?(l.isBuffer(_)||(_=l.from(_)),_.copy(h,p)):Uint8Array.prototype.set.call(h,_,p);else if(l.isBuffer(_))_.copy(h,p);else throw new TypeError('"list" argument must be an Array of Buffers');p+=_.length}return h};function S(o,n){if(l.isBuffer(o))return o.length;if(ArrayBuffer.isView(o)||Y(o,ArrayBuffer))return o.byteLength;if(typeof o!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof o);const i=o.length,u=arguments.length>2&&arguments[2]===!0;if(!u&&i===0)return 0;let h=!1;for(;;)switch(n){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return De(o).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return i*2;case"hex":return i>>>1;case"base64":return It(o).length;default:if(h)return u?-1:De(o).length;n=(""+n).toLowerCase(),h=!0}}l.byteLength=S;function A(o,n,i){let u=!1;if((n===void 0||n<0)&&(n=0),n>this.length||((i===void 0||i>this.length)&&(i=this.length),i<=0)||(i>>>=0,n>>>=0,i<=n))return"";for(o||(o="utf8");;)switch(o){case"hex":return jr(this,n,i);case"utf8":case"utf-8":return bt(this,n,i);case"ascii":return Ur(this,n,i);case"latin1":case"binary":return Pr(this,n,i);case"base64":return Or(this,n,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $r(this,n,i);default:if(u)throw new TypeError("Unknown encoding: "+o);o=(o+"").toLowerCase(),u=!0}}l.prototype._isBuffer=!0;function I(o,n,i){const u=o[n];o[n]=o[i],o[i]=u}l.prototype.swap16=function(){const n=this.length;if(n%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let i=0;i<n;i+=2)I(this,i,i+1);return this},l.prototype.swap32=function(){const n=this.length;if(n%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let i=0;i<n;i+=4)I(this,i,i+3),I(this,i+1,i+2);return this},l.prototype.swap64=function(){const n=this.length;if(n%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let i=0;i<n;i+=8)I(this,i,i+7),I(this,i+1,i+6),I(this,i+2,i+5),I(this,i+3,i+4);return this},l.prototype.toString=function(){const n=this.length;return n===0?"":arguments.length===0?bt(this,0,n):A.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(n){if(!l.isBuffer(n))throw new TypeError("Argument must be a Buffer");return this===n?!0:l.compare(this,n)===0},l.prototype.inspect=function(){let n="";const i=t.INSPECT_MAX_BYTES;return n=this.toString("hex",0,i).replace(/(.{2})/g,"$1 ").trim(),this.length>i&&(n+=" ... "),"<Buffer "+n+">"},s&&(l.prototype[s]=l.prototype.inspect),l.prototype.compare=function(n,i,u,h,p){if(Y(n,Uint8Array)&&(n=l.from(n,n.offset,n.byteLength)),!l.isBuffer(n))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof n);if(i===void 0&&(i=0),u===void 0&&(u=n?n.length:0),h===void 0&&(h=0),p===void 0&&(p=this.length),i<0||u>n.length||h<0||p>this.length)throw new RangeError("out of range index");if(h>=p&&i>=u)return 0;if(h>=p)return-1;if(i>=u)return 1;if(i>>>=0,u>>>=0,h>>>=0,p>>>=0,this===n)return 0;let _=p-h,N=u-i;const D=Math.min(_,N),O=this.slice(h,p),U=n.slice(i,u);for(let k=0;k<D;++k)if(O[k]!==U[k]){_=O[k],N=U[k];break}return _<N?-1:N<_?1:0};function q(o,n,i,u,h){if(o.length===0)return-1;if(typeof i=="string"?(u=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,Ue(i)&&(i=h?0:o.length-1),i<0&&(i=o.length+i),i>=o.length){if(h)return-1;i=o.length-1}else if(i<0)if(h)i=0;else return-1;if(typeof n=="string"&&(n=l.from(n,u)),l.isBuffer(n))return n.length===0?-1:G(o,n,i,u,h);if(typeof n=="number")return n=n&255,typeof Uint8Array.prototype.indexOf=="function"?h?Uint8Array.prototype.indexOf.call(o,n,i):Uint8Array.prototype.lastIndexOf.call(o,n,i):G(o,[n],i,u,h);throw new TypeError("val must be string, number or Buffer")}function G(o,n,i,u,h){let p=1,_=o.length,N=n.length;if(u!==void 0&&(u=String(u).toLowerCase(),u==="ucs2"||u==="ucs-2"||u==="utf16le"||u==="utf-16le")){if(o.length<2||n.length<2)return-1;p=2,_/=2,N/=2,i/=2}function D(U,k){return p===1?U[k]:U.readUInt16BE(k*p)}let O;if(h){let U=-1;for(O=i;O<_;O++)if(D(o,O)===D(n,U===-1?0:O-U)){if(U===-1&&(U=O),O-U+1===N)return U*p}else U!==-1&&(O-=O-U),U=-1}else for(i+N>_&&(i=_-N),O=i;O>=0;O--){let U=!0;for(let k=0;k<N;k++)if(D(o,O+k)!==D(n,k)){U=!1;break}if(U)return O}return-1}l.prototype.includes=function(n,i,u){return this.indexOf(n,i,u)!==-1},l.prototype.indexOf=function(n,i,u){return q(this,n,i,u,!0)},l.prototype.lastIndexOf=function(n,i,u){return q(this,n,i,u,!1)};function J(o,n,i,u){i=Number(i)||0;const h=o.length-i;u?(u=Number(u),u>h&&(u=h)):u=h;const p=n.length;u>p/2&&(u=p/2);let _;for(_=0;_<u;++_){const N=parseInt(n.substr(_*2,2),16);if(Ue(N))return _;o[i+_]=N}return _}function ke(o,n,i,u){return Re(De(n,o.length-i),o,i,u)}function Fr(o,n,i,u){return Re(Vr(n),o,i,u)}function Lr(o,n,i,u){return Re(It(n),o,i,u)}function kr(o,n,i,u){return Re(Gr(n,o.length-i),o,i,u)}l.prototype.write=function(n,i,u,h){if(i===void 0)h="utf8",u=this.length,i=0;else if(u===void 0&&typeof i=="string")h=i,u=this.length,i=0;else if(isFinite(i))i=i>>>0,isFinite(u)?(u=u>>>0,h===void 0&&(h="utf8")):(h=u,u=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const p=this.length-i;if((u===void 0||u>p)&&(u=p),n.length>0&&(u<0||i<0)||i>this.length)throw new RangeError("Attempt to write outside buffer bounds");h||(h="utf8");let _=!1;for(;;)switch(h){case"hex":return J(this,n,i,u);case"utf8":case"utf-8":return ke(this,n,i,u);case"ascii":case"latin1":case"binary":return Fr(this,n,i,u);case"base64":return Lr(this,n,i,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return kr(this,n,i,u);default:if(_)throw new TypeError("Unknown encoding: "+h);h=(""+h).toLowerCase(),_=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Or(o,n,i){return n===0&&i===o.length?e.fromByteArray(o):e.fromByteArray(o.slice(n,i))}function bt(o,n,i){i=Math.min(o.length,i);const u=[];let h=n;for(;h<i;){const p=o[h];let _=null,N=p>239?4:p>223?3:p>191?2:1;if(h+N<=i){let D,O,U,k;switch(N){case 1:p<128&&(_=p);break;case 2:D=o[h+1],(D&192)===128&&(k=(p&31)<<6|D&63,k>127&&(_=k));break;case 3:D=o[h+1],O=o[h+2],(D&192)===128&&(O&192)===128&&(k=(p&15)<<12|(D&63)<<6|O&63,k>2047&&(k<55296||k>57343)&&(_=k));break;case 4:D=o[h+1],O=o[h+2],U=o[h+3],(D&192)===128&&(O&192)===128&&(U&192)===128&&(k=(p&15)<<18|(D&63)<<12|(O&63)<<6|U&63,k>65535&&k<1114112&&(_=k))}}_===null?(_=65533,N=1):_>65535&&(_-=65536,u.push(_>>>10&1023|55296),_=56320|_&1023),u.push(_),h+=N}return Dr(u)}const Et=4096;function Dr(o){const n=o.length;if(n<=Et)return String.fromCharCode.apply(String,o);let i="",u=0;for(;u<n;)i+=String.fromCharCode.apply(String,o.slice(u,u+=Et));return i}function Ur(o,n,i){let u="";i=Math.min(o.length,i);for(let h=n;h<i;++h)u+=String.fromCharCode(o[h]&127);return u}function Pr(o,n,i){let u="";i=Math.min(o.length,i);for(let h=n;h<i;++h)u+=String.fromCharCode(o[h]);return u}function jr(o,n,i){const u=o.length;(!n||n<0)&&(n=0),(!i||i<0||i>u)&&(i=u);let h="";for(let p=n;p<i;++p)h+=Yr[o[p]];return h}function $r(o,n,i){const u=o.slice(n,i);let h="";for(let p=0;p<u.length-1;p+=2)h+=String.fromCharCode(u[p]+u[p+1]*256);return h}l.prototype.slice=function(n,i){const u=this.length;n=~~n,i=i===void 0?u:~~i,n<0?(n+=u,n<0&&(n=0)):n>u&&(n=u),i<0?(i+=u,i<0&&(i=0)):i>u&&(i=u),i<n&&(i=n);const h=this.subarray(n,i);return Object.setPrototypeOf(h,l.prototype),h};function j(o,n,i){if(o%1!==0||o<0)throw new RangeError("offset is not uint");if(o+n>i)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(n,i,u){n=n>>>0,i=i>>>0,u||j(n,i,this.length);let h=this[n],p=1,_=0;for(;++_<i&&(p*=256);)h+=this[n+_]*p;return h},l.prototype.readUintBE=l.prototype.readUIntBE=function(n,i,u){n=n>>>0,i=i>>>0,u||j(n,i,this.length);let h=this[n+--i],p=1;for(;i>0&&(p*=256);)h+=this[n+--i]*p;return h},l.prototype.readUint8=l.prototype.readUInt8=function(n,i){return n=n>>>0,i||j(n,1,this.length),this[n]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(n,i){return n=n>>>0,i||j(n,2,this.length),this[n]|this[n+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(n,i){return n=n>>>0,i||j(n,2,this.length),this[n]<<8|this[n+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(n,i){return n=n>>>0,i||j(n,4,this.length),(this[n]|this[n+1]<<8|this[n+2]<<16)+this[n+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(n,i){return n=n>>>0,i||j(n,4,this.length),this[n]*16777216+(this[n+1]<<16|this[n+2]<<8|this[n+3])},l.prototype.readBigUInt64LE=Q(function(n){n=n>>>0,oe(n,"offset");const i=this[n],u=this[n+7];(i===void 0||u===void 0)&&pe(n,this.length-8);const h=i+this[++n]*2**8+this[++n]*2**16+this[++n]*2**24,p=this[++n]+this[++n]*2**8+this[++n]*2**16+u*2**24;return BigInt(h)+(BigInt(p)<<BigInt(32))}),l.prototype.readBigUInt64BE=Q(function(n){n=n>>>0,oe(n,"offset");const i=this[n],u=this[n+7];(i===void 0||u===void 0)&&pe(n,this.length-8);const h=i*2**24+this[++n]*2**16+this[++n]*2**8+this[++n],p=this[++n]*2**24+this[++n]*2**16+this[++n]*2**8+u;return(BigInt(h)<<BigInt(32))+BigInt(p)}),l.prototype.readIntLE=function(n,i,u){n=n>>>0,i=i>>>0,u||j(n,i,this.length);let h=this[n],p=1,_=0;for(;++_<i&&(p*=256);)h+=this[n+_]*p;return p*=128,h>=p&&(h-=Math.pow(2,8*i)),h},l.prototype.readIntBE=function(n,i,u){n=n>>>0,i=i>>>0,u||j(n,i,this.length);let h=i,p=1,_=this[n+--h];for(;h>0&&(p*=256);)_+=this[n+--h]*p;return p*=128,_>=p&&(_-=Math.pow(2,8*i)),_},l.prototype.readInt8=function(n,i){return n=n>>>0,i||j(n,1,this.length),this[n]&128?(255-this[n]+1)*-1:this[n]},l.prototype.readInt16LE=function(n,i){n=n>>>0,i||j(n,2,this.length);const u=this[n]|this[n+1]<<8;return u&32768?u|4294901760:u},l.prototype.readInt16BE=function(n,i){n=n>>>0,i||j(n,2,this.length);const u=this[n+1]|this[n]<<8;return u&32768?u|4294901760:u},l.prototype.readInt32LE=function(n,i){return n=n>>>0,i||j(n,4,this.length),this[n]|this[n+1]<<8|this[n+2]<<16|this[n+3]<<24},l.prototype.readInt32BE=function(n,i){return n=n>>>0,i||j(n,4,this.length),this[n]<<24|this[n+1]<<16|this[n+2]<<8|this[n+3]},l.prototype.readBigInt64LE=Q(function(n){n=n>>>0,oe(n,"offset");const i=this[n],u=this[n+7];(i===void 0||u===void 0)&&pe(n,this.length-8);const h=this[n+4]+this[n+5]*2**8+this[n+6]*2**16+(u<<24);return(BigInt(h)<<BigInt(32))+BigInt(i+this[++n]*2**8+this[++n]*2**16+this[++n]*2**24)}),l.prototype.readBigInt64BE=Q(function(n){n=n>>>0,oe(n,"offset");const i=this[n],u=this[n+7];(i===void 0||u===void 0)&&pe(n,this.length-8);const h=(i<<24)+this[++n]*2**16+this[++n]*2**8+this[++n];return(BigInt(h)<<BigInt(32))+BigInt(this[++n]*2**24+this[++n]*2**16+this[++n]*2**8+u)}),l.prototype.readFloatLE=function(n,i){return n=n>>>0,i||j(n,4,this.length),r.read(this,n,!0,23,4)},l.prototype.readFloatBE=function(n,i){return n=n>>>0,i||j(n,4,this.length),r.read(this,n,!1,23,4)},l.prototype.readDoubleLE=function(n,i){return n=n>>>0,i||j(n,8,this.length),r.read(this,n,!0,52,8)},l.prototype.readDoubleBE=function(n,i){return n=n>>>0,i||j(n,8,this.length),r.read(this,n,!1,52,8)};function W(o,n,i,u,h,p){if(!l.isBuffer(o))throw new TypeError('"buffer" argument must be a Buffer instance');if(n>h||n<p)throw new RangeError('"value" argument is out of bounds');if(i+u>o.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(n,i,u,h){if(n=+n,i=i>>>0,u=u>>>0,!h){const N=Math.pow(2,8*u)-1;W(this,n,i,u,N,0)}let p=1,_=0;for(this[i]=n&255;++_<u&&(p*=256);)this[i+_]=n/p&255;return i+u},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(n,i,u,h){if(n=+n,i=i>>>0,u=u>>>0,!h){const N=Math.pow(2,8*u)-1;W(this,n,i,u,N,0)}let p=u-1,_=1;for(this[i+p]=n&255;--p>=0&&(_*=256);)this[i+p]=n/_&255;return i+u},l.prototype.writeUint8=l.prototype.writeUInt8=function(n,i,u){return n=+n,i=i>>>0,u||W(this,n,i,1,255,0),this[i]=n&255,i+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(n,i,u){return n=+n,i=i>>>0,u||W(this,n,i,2,65535,0),this[i]=n&255,this[i+1]=n>>>8,i+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(n,i,u){return n=+n,i=i>>>0,u||W(this,n,i,2,65535,0),this[i]=n>>>8,this[i+1]=n&255,i+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(n,i,u){return n=+n,i=i>>>0,u||W(this,n,i,4,4294967295,0),this[i+3]=n>>>24,this[i+2]=n>>>16,this[i+1]=n>>>8,this[i]=n&255,i+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(n,i,u){return n=+n,i=i>>>0,u||W(this,n,i,4,4294967295,0),this[i]=n>>>24,this[i+1]=n>>>16,this[i+2]=n>>>8,this[i+3]=n&255,i+4};function Rt(o,n,i,u,h){At(n,u,h,o,i,7);let p=Number(n&BigInt(4294967295));o[i++]=p,p=p>>8,o[i++]=p,p=p>>8,o[i++]=p,p=p>>8,o[i++]=p;let _=Number(n>>BigInt(32)&BigInt(4294967295));return o[i++]=_,_=_>>8,o[i++]=_,_=_>>8,o[i++]=_,_=_>>8,o[i++]=_,i}function vt(o,n,i,u,h){At(n,u,h,o,i,7);let p=Number(n&BigInt(4294967295));o[i+7]=p,p=p>>8,o[i+6]=p,p=p>>8,o[i+5]=p,p=p>>8,o[i+4]=p;let _=Number(n>>BigInt(32)&BigInt(4294967295));return o[i+3]=_,_=_>>8,o[i+2]=_,_=_>>8,o[i+1]=_,_=_>>8,o[i]=_,i+8}l.prototype.writeBigUInt64LE=Q(function(n,i=0){return Rt(this,n,i,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=Q(function(n,i=0){return vt(this,n,i,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(n,i,u,h){if(n=+n,i=i>>>0,!h){const D=Math.pow(2,8*u-1);W(this,n,i,u,D-1,-D)}let p=0,_=1,N=0;for(this[i]=n&255;++p<u&&(_*=256);)n<0&&N===0&&this[i+p-1]!==0&&(N=1),this[i+p]=(n/_>>0)-N&255;return i+u},l.prototype.writeIntBE=function(n,i,u,h){if(n=+n,i=i>>>0,!h){const D=Math.pow(2,8*u-1);W(this,n,i,u,D-1,-D)}let p=u-1,_=1,N=0;for(this[i+p]=n&255;--p>=0&&(_*=256);)n<0&&N===0&&this[i+p+1]!==0&&(N=1),this[i+p]=(n/_>>0)-N&255;return i+u},l.prototype.writeInt8=function(n,i,u){return n=+n,i=i>>>0,u||W(this,n,i,1,127,-128),n<0&&(n=255+n+1),this[i]=n&255,i+1},l.prototype.writeInt16LE=function(n,i,u){return n=+n,i=i>>>0,u||W(this,n,i,2,32767,-32768),this[i]=n&255,this[i+1]=n>>>8,i+2},l.prototype.writeInt16BE=function(n,i,u){return n=+n,i=i>>>0,u||W(this,n,i,2,32767,-32768),this[i]=n>>>8,this[i+1]=n&255,i+2},l.prototype.writeInt32LE=function(n,i,u){return n=+n,i=i>>>0,u||W(this,n,i,4,2147483647,-2147483648),this[i]=n&255,this[i+1]=n>>>8,this[i+2]=n>>>16,this[i+3]=n>>>24,i+4},l.prototype.writeInt32BE=function(n,i,u){return n=+n,i=i>>>0,u||W(this,n,i,4,2147483647,-2147483648),n<0&&(n=4294967295+n+1),this[i]=n>>>24,this[i+1]=n>>>16,this[i+2]=n>>>8,this[i+3]=n&255,i+4},l.prototype.writeBigInt64LE=Q(function(n,i=0){return Rt(this,n,i,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=Q(function(n,i=0){return vt(this,n,i,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ct(o,n,i,u,h,p){if(i+u>o.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function St(o,n,i,u,h){return n=+n,i=i>>>0,h||Ct(o,n,i,4),r.write(o,n,i,u,23,4),i+4}l.prototype.writeFloatLE=function(n,i,u){return St(this,n,i,!0,u)},l.prototype.writeFloatBE=function(n,i,u){return St(this,n,i,!1,u)};function Tt(o,n,i,u,h){return n=+n,i=i>>>0,h||Ct(o,n,i,8),r.write(o,n,i,u,52,8),i+8}l.prototype.writeDoubleLE=function(n,i,u){return Tt(this,n,i,!0,u)},l.prototype.writeDoubleBE=function(n,i,u){return Tt(this,n,i,!1,u)},l.prototype.copy=function(n,i,u,h){if(!l.isBuffer(n))throw new TypeError("argument should be a Buffer");if(u||(u=0),!h&&h!==0&&(h=this.length),i>=n.length&&(i=n.length),i||(i=0),h>0&&h<u&&(h=u),h===u||n.length===0||this.length===0)return 0;if(i<0)throw new RangeError("targetStart out of bounds");if(u<0||u>=this.length)throw new RangeError("Index out of range");if(h<0)throw new RangeError("sourceEnd out of bounds");h>this.length&&(h=this.length),n.length-i<h-u&&(h=n.length-i+u);const p=h-u;return this===n&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(i,u,h):Uint8Array.prototype.set.call(n,this.subarray(u,h),i),p},l.prototype.fill=function(n,i,u,h){if(typeof n=="string"){if(typeof i=="string"?(h=i,i=0,u=this.length):typeof u=="string"&&(h=u,u=this.length),h!==void 0&&typeof h!="string")throw new TypeError("encoding must be a string");if(typeof h=="string"&&!l.isEncoding(h))throw new TypeError("Unknown encoding: "+h);if(n.length===1){const _=n.charCodeAt(0);(h==="utf8"&&_<128||h==="latin1")&&(n=_)}}else typeof n=="number"?n=n&255:typeof n=="boolean"&&(n=Number(n));if(i<0||this.length<i||this.length<u)throw new RangeError("Out of range index");if(u<=i)return this;i=i>>>0,u=u===void 0?this.length:u>>>0,n||(n=0);let p;if(typeof n=="number")for(p=i;p<u;++p)this[p]=n;else{const _=l.isBuffer(n)?n:l.from(n,h),N=_.length;if(N===0)throw new TypeError('The value "'+n+'" is invalid for argument "value"');for(p=0;p<u-i;++p)this[p+i]=_[p%N]}return this};const se={};function Oe(o,n,i){se[o]=class extends i{constructor(){super(),Object.defineProperty(this,"message",{value:n.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${o}]`,this.stack,delete this.name}get code(){return o}set code(h){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:h,writable:!0})}toString(){return`${this.name} [${o}]: ${this.message}`}}}Oe("ERR_BUFFER_OUT_OF_BOUNDS",function(o){return o?`${o} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Oe("ERR_INVALID_ARG_TYPE",function(o,n){return`The "${o}" argument must be of type number. Received type ${typeof n}`},TypeError),Oe("ERR_OUT_OF_RANGE",function(o,n,i){let u=`The value of "${o}" is out of range.`,h=i;return Number.isInteger(i)&&Math.abs(i)>2**32?h=xt(String(i)):typeof i=="bigint"&&(h=String(i),(i>BigInt(2)**BigInt(32)||i<-(BigInt(2)**BigInt(32)))&&(h=xt(h)),h+="n"),u+=` It must be ${n}. Received ${h}`,u},RangeError);function xt(o){let n="",i=o.length;const u=o[0]==="-"?1:0;for(;i>=u+4;i-=3)n=`_${o.slice(i-3,i)}${n}`;return`${o.slice(0,i)}${n}`}function qr(o,n,i){oe(n,"offset"),(o[n]===void 0||o[n+i]===void 0)&&pe(n,o.length-(i+1))}function At(o,n,i,u,h,p){if(o>i||o<n){const _=typeof n=="bigint"?"n":"";let N;throw p>3?n===0||n===BigInt(0)?N=`>= 0${_} and < 2${_} ** ${(p+1)*8}${_}`:N=`>= -(2${_} ** ${(p+1)*8-1}${_}) and < 2 ** ${(p+1)*8-1}${_}`:N=`>= ${n}${_} and <= ${i}${_}`,new se.ERR_OUT_OF_RANGE("value",N,o)}qr(u,h,p)}function oe(o,n){if(typeof o!="number")throw new se.ERR_INVALID_ARG_TYPE(n,"number",o)}function pe(o,n,i){throw Math.floor(o)!==o?(oe(o,i),new se.ERR_OUT_OF_RANGE(i||"offset","an integer",o)):n<0?new se.ERR_BUFFER_OUT_OF_BOUNDS:new se.ERR_OUT_OF_RANGE(i||"offset",`>= ${i?1:0} and <= ${n}`,o)}const Wr=/[^+/0-9A-Za-z-_]/g;function Hr(o){if(o=o.split("=")[0],o=o.trim().replace(Wr,""),o.length<2)return"";for(;o.length%4!==0;)o=o+"=";return o}function De(o,n){n=n||1/0;let i;const u=o.length;let h=null;const p=[];for(let _=0;_<u;++_){if(i=o.charCodeAt(_),i>55295&&i<57344){if(!h){if(i>56319){(n-=3)>-1&&p.push(239,191,189);continue}else if(_+1===u){(n-=3)>-1&&p.push(239,191,189);continue}h=i;continue}if(i<56320){(n-=3)>-1&&p.push(239,191,189),h=i;continue}i=(h-55296<<10|i-56320)+65536}else h&&(n-=3)>-1&&p.push(239,191,189);if(h=null,i<128){if((n-=1)<0)break;p.push(i)}else if(i<2048){if((n-=2)<0)break;p.push(i>>6|192,i&63|128)}else if(i<65536){if((n-=3)<0)break;p.push(i>>12|224,i>>6&63|128,i&63|128)}else if(i<1114112){if((n-=4)<0)break;p.push(i>>18|240,i>>12&63|128,i>>6&63|128,i&63|128)}else throw new Error("Invalid code point")}return p}function Vr(o){const n=[];for(let i=0;i<o.length;++i)n.push(o.charCodeAt(i)&255);return n}function Gr(o,n){let i,u,h;const p=[];for(let _=0;_<o.length&&!((n-=2)<0);++_)i=o.charCodeAt(_),u=i>>8,h=i%256,p.push(h),p.push(u);return p}function It(o){return e.toByteArray(Hr(o))}function Re(o,n,i,u){let h;for(h=0;h<u&&!(h+i>=n.length||h>=o.length);++h)n[h+i]=o[h];return h}function Y(o,n){return o instanceof n||o!=null&&o.constructor!=null&&o.constructor.name!=null&&o.constructor.name===n.name}function Ue(o){return o!==o}const Yr=function(){const o="0123456789abcdef",n=new Array(256);for(let i=0;i<16;++i){const u=i*16;for(let h=0;h<16;++h)n[u+h]=o[i]+o[h]}return n}();function Q(o){return typeof BigInt>"u"?Kr:o}function Kr(){throw new Error("BigInt not supported")}})(he);/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(t,e){var r=he,s=r.Buffer;function a(c,l){for(var w in c)l[w]=c[w]}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?t.exports=r:(a(r,e),e.Buffer=f);function f(c,l,w){return s(c,l,w)}f.prototype=Object.create(s.prototype),a(s,f),f.from=function(c,l,w){if(typeof c=="number")throw new TypeError("Argument must not be a number");return s(c,l,w)},f.alloc=function(c,l,w){if(typeof c!="number")throw new TypeError("Argument must be a number");var m=s(c);return l!==void 0?typeof w=="string"?m.fill(l,w):m.fill(l):m.fill(0),m},f.allocUnsafe=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return s(c)},f.allocUnsafeSlow=function(c){if(typeof c!="number")throw new TypeError("Argument must be a number");return r.SlowBuffer(c)}})(ot,ot.exports);var nr=ot.exports,$e=65536,kn=4294967295;function On(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var Dn=nr.Buffer,xe=re.crypto||re.msCrypto;xe&&xe.getRandomValues?st.exports=Un:st.exports=On;function Un(t,e){if(t>kn)throw new RangeError("requested too many random bytes");var r=Dn.allocUnsafe(t);if(t>0)if(t>$e)for(var s=0;s<t;s+=$e)xe.getRandomValues(r.slice(s,s+$e));else xe.getRandomValues(r);return typeof e=="function"?process.nextTick(function(){e(null,r)}):r}var Pn=st.exports,at={exports:{}},de={},dt={exports:{}},ue=typeof Reflect=="object"?Reflect:null,Ft=ue&&typeof ue.apply=="function"?ue.apply:function(e,r,s){return Function.prototype.apply.call(e,r,s)},ve;ue&&typeof ue.ownKeys=="function"?ve=ue.ownKeys:Object.getOwnPropertySymbols?ve=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ve=function(e){return Object.getOwnPropertyNames(e)};function jn(t){console&&console.warn&&console.warn(t)}var ir=Number.isNaN||function(e){return e!==e};function L(){L.init.call(this)}dt.exports=L;dt.exports.once=Hn;L.EventEmitter=L;L.prototype._events=void 0;L.prototype._eventsCount=0;L.prototype._maxListeners=void 0;var Lt=10;function Ie(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(L,"defaultMaxListeners",{enumerable:!0,get:function(){return Lt},set:function(t){if(typeof t!="number"||t<0||ir(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Lt=t}});L.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};L.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||ir(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function sr(t){return t._maxListeners===void 0?L.defaultMaxListeners:t._maxListeners}L.prototype.getMaxListeners=function(){return sr(this)};L.prototype.emit=function(e){for(var r=[],s=1;s<arguments.length;s++)r.push(arguments[s]);var a=e==="error",f=this._events;if(f!==void 0)a=a&&f.error===void 0;else if(!a)return!1;if(a){var c;if(r.length>0&&(c=r[0]),c instanceof Error)throw c;var l=new Error("Unhandled error."+(c?" ("+c.message+")":""));throw l.context=c,l}var w=f[e];if(w===void 0)return!1;if(typeof w=="function")Ft(w,this,r);else for(var m=w.length,g=fr(w,m),s=0;s<m;++s)Ft(g[s],this,r);return!0};function or(t,e,r,s){var a,f,c;if(Ie(r),f=t._events,f===void 0?(f=t._events=Object.create(null),t._eventsCount=0):(f.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),f=t._events),c=f[e]),c===void 0)c=f[e]=r,++t._eventsCount;else if(typeof c=="function"?c=f[e]=s?[r,c]:[c,r]:s?c.unshift(r):c.push(r),a=sr(t),a>0&&c.length>a&&!c.warned){c.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=c.length,jn(l)}return t}L.prototype.addListener=function(e,r){return or(this,e,r,!1)};L.prototype.on=L.prototype.addListener;L.prototype.prependListener=function(e,r){return or(this,e,r,!0)};function $n(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ar(t,e,r){var s={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},a=$n.bind(s);return a.listener=r,s.wrapFn=a,a}L.prototype.once=function(e,r){return Ie(r),this.on(e,ar(this,e,r)),this};L.prototype.prependOnceListener=function(e,r){return Ie(r),this.prependListener(e,ar(this,e,r)),this};L.prototype.removeListener=function(e,r){var s,a,f,c,l;if(Ie(r),a=this._events,a===void 0)return this;if(s=a[e],s===void 0)return this;if(s===r||s.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete a[e],a.removeListener&&this.emit("removeListener",e,s.listener||r));else if(typeof s!="function"){for(f=-1,c=s.length-1;c>=0;c--)if(s[c]===r||s[c].listener===r){l=s[c].listener,f=c;break}if(f<0)return this;f===0?s.shift():qn(s,f),s.length===1&&(a[e]=s[0]),a.removeListener!==void 0&&this.emit("removeListener",e,l||r)}return this};L.prototype.off=L.prototype.removeListener;L.prototype.removeAllListeners=function(e){var r,s,a;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var f=Object.keys(s),c;for(a=0;a<f.length;++a)c=f[a],c!=="removeListener"&&this.removeAllListeners(c);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=s[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(a=r.length-1;a>=0;a--)this.removeListener(e,r[a]);return this};function ur(t,e,r){var s=t._events;if(s===void 0)return[];var a=s[e];return a===void 0?[]:typeof a=="function"?r?[a.listener||a]:[a]:r?Wn(a):fr(a,a.length)}L.prototype.listeners=function(e){return ur(this,e,!0)};L.prototype.rawListeners=function(e){return ur(this,e,!1)};L.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):lr.call(t,e)};L.prototype.listenerCount=lr;function lr(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}L.prototype.eventNames=function(){return this._eventsCount>0?ve(this._events):[]};function fr(t,e){for(var r=new Array(e),s=0;s<e;++s)r[s]=t[s];return r}function qn(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Wn(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function Hn(t,e){return new Promise(function(r,s){function a(c){t.removeListener(e,f),s(c)}function f(){typeof t.removeListener=="function"&&t.removeListener("error",a),r([].slice.call(arguments))}cr(t,e,f,{once:!0}),e!=="error"&&Vn(t,a,{once:!0})})}function Vn(t,e,r){typeof t.on=="function"&&cr(t,"error",e,r)}function cr(t,e,r,s){if(typeof t.on=="function")s.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function a(f){s.once&&t.removeEventListener(e,a),r(f)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var hr=dt.exports,dr=hr.EventEmitter,qe,kt;function Gn(){if(kt)return qe;kt=1;function t(E,C){var R=Object.keys(E);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(E);C&&(v=v.filter(function(T){return Object.getOwnPropertyDescriptor(E,T).enumerable})),R.push.apply(R,v)}return R}function e(E){for(var C=1;C<arguments.length;C++){var R=arguments[C]!=null?arguments[C]:{};C%2?t(Object(R),!0).forEach(function(v){r(E,v,R[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(R)):t(Object(R)).forEach(function(v){Object.defineProperty(E,v,Object.getOwnPropertyDescriptor(R,v))})}return E}function r(E,C,R){return C in E?Object.defineProperty(E,C,{value:R,enumerable:!0,configurable:!0,writable:!0}):E[C]=R,E}function s(E,C){if(!(E instanceof C))throw new TypeError("Cannot call a class as a function")}function a(E,C){for(var R=0;R<C.length;R++){var v=C[R];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(E,v.key,v)}}function f(E,C,R){return C&&a(E.prototype,C),R&&a(E,R),E}var c=he,l=c.Buffer,w=tr,m=w.inspect,g=m&&m.custom||"inspect";function y(E,C,R){l.prototype.copy.call(E,C,R)}return qe=function(){function E(){s(this,E),this.head=null,this.tail=null,this.length=0}return f(E,[{key:"push",value:function(R){var v={data:R,next:null};this.length>0?this.tail.next=v:this.head=v,this.tail=v,++this.length}},{key:"unshift",value:function(R){var v={data:R,next:this.head};this.length===0&&(this.tail=v),this.head=v,++this.length}},{key:"shift",value:function(){if(this.length!==0){var R=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,R}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(R){if(this.length===0)return"";for(var v=this.head,T=""+v.data;v=v.next;)T+=R+v.data;return T}},{key:"concat",value:function(R){if(this.length===0)return l.alloc(0);for(var v=l.allocUnsafe(R>>>0),T=this.head,d=0;T;)y(T.data,v,d),d+=T.data.length,T=T.next;return v}},{key:"consume",value:function(R,v){var T;return R<this.head.data.length?(T=this.head.data.slice(0,R),this.head.data=this.head.data.slice(R)):R===this.head.data.length?T=this.shift():T=v?this._getString(R):this._getBuffer(R),T}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(R){var v=this.head,T=1,d=v.data;for(R-=d.length;v=v.next;){var b=v.data,S=R>b.length?b.length:R;if(S===b.length?d+=b:d+=b.slice(0,R),R-=S,R===0){S===b.length?(++T,v.next?this.head=v.next:this.head=this.tail=null):(this.head=v,v.data=b.slice(S));break}++T}return this.length-=T,d}},{key:"_getBuffer",value:function(R){var v=l.allocUnsafe(R),T=this.head,d=1;for(T.data.copy(v),R-=T.data.length;T=T.next;){var b=T.data,S=R>b.length?b.length:R;if(b.copy(v,v.length-R,0,S),R-=S,R===0){S===b.length?(++d,T.next?this.head=T.next:this.head=this.tail=null):(this.head=T,T.data=b.slice(S));break}++d}return this.length-=d,v}},{key:g,value:function(R,v){return m(this,e({},v,{depth:0,customInspect:!1}))}}]),E}(),qe}function Yn(t,e){var r=this,s=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;return s||a?(e?e(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(ut,this,t)):process.nextTick(ut,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(f){!e&&f?r._writableState?r._writableState.errorEmitted?process.nextTick(Ce,r):(r._writableState.errorEmitted=!0,process.nextTick(Ot,r,f)):process.nextTick(Ot,r,f):e?(process.nextTick(Ce,r),e(f)):process.nextTick(Ce,r)}),this)}function Ot(t,e){ut(t,e),Ce(t)}function Ce(t){t._writableState&&!t._writableState.emitClose||t._readableState&&!t._readableState.emitClose||t.emit("close")}function Kn(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function ut(t,e){t.emit("error",e)}function zn(t,e){var r=t._readableState,s=t._writableState;r&&r.autoDestroy||s&&s.autoDestroy?t.destroy(e):t.emit("error",e)}var pr={destroy:Yn,undestroy:Kn,errorOrDestroy:zn},ie={};function Jn(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var gr={};function V(t,e,r){r||(r=Error);function s(f,c,l){return typeof e=="string"?e:e(f,c,l)}var a=function(f){Jn(c,f);function c(l,w,m){return f.call(this,s(l,w,m))||this}return c}(r);a.prototype.name=r.name,a.prototype.code=t,gr[t]=a}function Dt(t,e){if(Array.isArray(t)){var r=t.length;return t=t.map(function(s){return String(s)}),r>2?"one of ".concat(e," ").concat(t.slice(0,r-1).join(", "),", or ")+t[r-1]:r===2?"one of ".concat(e," ").concat(t[0]," or ").concat(t[1]):"of ".concat(e," ").concat(t[0])}else return"of ".concat(e," ").concat(String(t))}function Xn(t,e,r){return t.substr(!r||r<0?0:+r,e.length)===e}function Zn(t,e,r){return(r===void 0||r>t.length)&&(r=t.length),t.substring(r-e.length,r)===e}function Qn(t,e,r){return typeof r!="number"&&(r=0),r+e.length>t.length?!1:t.indexOf(e,r)!==-1}V("ERR_INVALID_OPT_VALUE",function(t,e){return'The value "'+e+'" is invalid for option "'+t+'"'},TypeError);V("ERR_INVALID_ARG_TYPE",function(t,e,r){var s;typeof e=="string"&&Xn(e,"not ")?(s="must not be",e=e.replace(/^not /,"")):s="must be";var a;if(Zn(t," argument"))a="The ".concat(t," ").concat(s," ").concat(Dt(e,"type"));else{var f=Qn(t,".")?"property":"argument";a='The "'.concat(t,'" ').concat(f," ").concat(s," ").concat(Dt(e,"type"))}return a+=". Received type ".concat(typeof r),a},TypeError);V("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");V("ERR_METHOD_NOT_IMPLEMENTED",function(t){return"The "+t+" method is not implemented"});V("ERR_STREAM_PREMATURE_CLOSE","Premature close");V("ERR_STREAM_DESTROYED",function(t){return"Cannot call "+t+" after a stream was destroyed"});V("ERR_MULTIPLE_CALLBACK","Callback called multiple times");V("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");V("ERR_STREAM_WRITE_AFTER_END","write after end");V("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);V("ERR_UNKNOWN_ENCODING",function(t){return"Unknown encoding: "+t},TypeError);V("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");ie.codes=gr;var ei=ie.codes.ERR_INVALID_OPT_VALUE;function ti(t,e,r){return t.highWaterMark!=null?t.highWaterMark:e?t[r]:null}function ri(t,e,r,s){var a=ti(e,s,r);if(a!=null){if(!(isFinite(a)&&Math.floor(a)===a)||a<0){var f=s?r:"highWaterMark";throw new ei(f,a)}return Math.floor(a)}return t.objectMode?16:16*1024}var yr={getHighWaterMark:ri},lt={exports:{}};typeof Object.create=="function"?lt.exports=function(e,r){r&&(e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:lt.exports=function(e,r){if(r){e.super_=r;var s=function(){};s.prototype=r.prototype,e.prototype=new s,e.prototype.constructor=e}};var we=lt.exports,We={},Ut;function _r(){if(Ut)return We;Ut=1;var t=nr.Buffer,e=t.isEncoding||function(d){switch(d=""+d,d&&d.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function r(d){if(!d)return"utf8";for(var b;;)switch(d){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return d;default:if(b)return;d=(""+d).toLowerCase(),b=!0}}function s(d){var b=r(d);if(typeof b!="string"&&(t.isEncoding===e||!e(d)))throw new Error("Unknown encoding: "+d);return b||d}We.StringDecoder=a;function a(d){this.encoding=s(d);var b;switch(this.encoding){case"utf16le":this.text=y,this.end=E,b=4;break;case"utf8":this.fillLast=w,b=4;break;case"base64":this.text=C,this.end=R,b=3;break;default:this.write=v,this.end=T;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=t.allocUnsafe(b)}a.prototype.write=function(d){if(d.length===0)return"";var b,S;if(this.lastNeed){if(b=this.fillLast(d),b===void 0)return"";S=this.lastNeed,this.lastNeed=0}else S=0;return S<d.length?b?b+this.text(d,S):this.text(d,S):b||""},a.prototype.end=g,a.prototype.text=m,a.prototype.fillLast=function(d){if(this.lastNeed<=d.length)return d.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);d.copy(this.lastChar,this.lastTotal-this.lastNeed,0,d.length),this.lastNeed-=d.length};function f(d){return d<=127?0:d>>5===6?2:d>>4===14?3:d>>3===30?4:d>>6===2?-1:-2}function c(d,b,S){var A=b.length-1;if(A<S)return 0;var I=f(b[A]);return I>=0?(I>0&&(d.lastNeed=I-1),I):--A<S||I===-2?0:(I=f(b[A]),I>=0?(I>0&&(d.lastNeed=I-2),I):--A<S||I===-2?0:(I=f(b[A]),I>=0?(I>0&&(I===2?I=0:d.lastNeed=I-3),I):0))}function l(d,b,S){if((b[0]&192)!==128)return d.lastNeed=0,"";if(d.lastNeed>1&&b.length>1){if((b[1]&192)!==128)return d.lastNeed=1,"";if(d.lastNeed>2&&b.length>2&&(b[2]&192)!==128)return d.lastNeed=2,""}}function w(d){var b=this.lastTotal-this.lastNeed,S=l(this,d);if(S!==void 0)return S;if(this.lastNeed<=d.length)return d.copy(this.lastChar,b,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);d.copy(this.lastChar,b,0,d.length),this.lastNeed-=d.length}function m(d,b){var S=c(this,d,b);if(!this.lastNeed)return d.toString("utf8",b);this.lastTotal=S;var A=d.length-(S-this.lastNeed);return d.copy(this.lastChar,0,A),d.toString("utf8",b,A)}function g(d){var b=d&&d.length?this.write(d):"";return this.lastNeed?b+"":b}function y(d,b){if((d.length-b)%2===0){var S=d.toString("utf16le",b);if(S){var A=S.charCodeAt(S.length-1);if(A>=55296&&A<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=d[d.length-2],this.lastChar[1]=d[d.length-1],S.slice(0,-1)}return S}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=d[d.length-1],d.toString("utf16le",b,d.length-1)}function E(d){var b=d&&d.length?this.write(d):"";if(this.lastNeed){var S=this.lastTotal-this.lastNeed;return b+this.lastChar.toString("utf16le",0,S)}return b}function C(d,b){var S=(d.length-b)%3;return S===0?d.toString("base64",b):(this.lastNeed=3-S,this.lastTotal=3,S===1?this.lastChar[0]=d[d.length-1]:(this.lastChar[0]=d[d.length-2],this.lastChar[1]=d[d.length-1]),d.toString("base64",b,d.length-S))}function R(d){var b=d&&d.length?this.write(d):"";return this.lastNeed?b+this.lastChar.toString("base64",0,3-this.lastNeed):b}function v(d){return d.toString(this.encoding)}function T(d){return d&&d.length?this.write(d):""}return We}var Pt=ie.codes.ERR_STREAM_PREMATURE_CLOSE;function ni(t){var e=!1;return function(){if(!e){e=!0;for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];t.apply(this,s)}}}function ii(){}function si(t){return t.setHeader&&typeof t.abort=="function"}function wr(t,e,r){if(typeof e=="function")return wr(t,null,e);e||(e={}),r=ni(r||ii);var s=e.readable||e.readable!==!1&&t.readable,a=e.writable||e.writable!==!1&&t.writable,f=function(){t.writable||l()},c=t._writableState&&t._writableState.finished,l=function(){a=!1,c=!0,s||r.call(t)},w=t._readableState&&t._readableState.endEmitted,m=function(){s=!1,w=!0,a||r.call(t)},g=function(R){r.call(t,R)},y=function(){var R;if(s&&!w)return(!t._readableState||!t._readableState.ended)&&(R=new Pt),r.call(t,R);if(a&&!c)return(!t._writableState||!t._writableState.ended)&&(R=new Pt),r.call(t,R)},E=function(){t.req.on("finish",l)};return si(t)?(t.on("complete",l),t.on("abort",y),t.req?E():t.on("request",E)):a&&!t._writableState&&(t.on("end",f),t.on("close",f)),t.on("end",m),t.on("finish",l),e.error!==!1&&t.on("error",g),t.on("close",y),function(){t.removeListener("complete",l),t.removeListener("abort",y),t.removeListener("request",E),t.req&&t.req.removeListener("finish",l),t.removeListener("end",f),t.removeListener("close",f),t.removeListener("finish",l),t.removeListener("end",m),t.removeListener("error",g),t.removeListener("close",y)}}var pt=wr,He,jt;function oi(){if(jt)return He;jt=1;var t;function e(d,b,S){return b in d?Object.defineProperty(d,b,{value:S,enumerable:!0,configurable:!0,writable:!0}):d[b]=S,d}var r=pt,s=Symbol("lastResolve"),a=Symbol("lastReject"),f=Symbol("error"),c=Symbol("ended"),l=Symbol("lastPromise"),w=Symbol("handlePromise"),m=Symbol("stream");function g(d,b){return{value:d,done:b}}function y(d){var b=d[s];if(b!==null){var S=d[m].read();S!==null&&(d[l]=null,d[s]=null,d[a]=null,b(g(S,!1)))}}function E(d){process.nextTick(y,d)}function C(d,b){return function(S,A){d.then(function(){if(b[c]){S(g(void 0,!0));return}b[w](S,A)},A)}}var R=Object.getPrototypeOf(function(){}),v=Object.setPrototypeOf((t={get stream(){return this[m]},next:function(){var b=this,S=this[f];if(S!==null)return Promise.reject(S);if(this[c])return Promise.resolve(g(void 0,!0));if(this[m].destroyed)return new Promise(function(G,J){process.nextTick(function(){b[f]?J(b[f]):G(g(void 0,!0))})});var A=this[l],I;if(A)I=new Promise(C(A,this));else{var q=this[m].read();if(q!==null)return Promise.resolve(g(q,!1));I=new Promise(this[w])}return this[l]=I,I}},e(t,Symbol.asyncIterator,function(){return this}),e(t,"return",function(){var b=this;return new Promise(function(S,A){b[m].destroy(null,function(I){if(I){A(I);return}S(g(void 0,!0))})})}),t),R),T=function(b){var S,A=Object.create(v,(S={},e(S,m,{value:b,writable:!0}),e(S,s,{value:null,writable:!0}),e(S,a,{value:null,writable:!0}),e(S,f,{value:null,writable:!0}),e(S,c,{value:b._readableState.endEmitted,writable:!0}),e(S,w,{value:function(q,G){var J=A[m].read();J?(A[l]=null,A[s]=null,A[a]=null,q(g(J,!1))):(A[s]=q,A[a]=G)},writable:!0}),S));return A[l]=null,r(b,function(I){if(I&&I.code!=="ERR_STREAM_PREMATURE_CLOSE"){var q=A[a];q!==null&&(A[l]=null,A[s]=null,A[a]=null,q(I)),A[f]=I;return}var G=A[s];G!==null&&(A[l]=null,A[s]=null,A[a]=null,G(g(void 0,!0))),A[c]=!0}),b.on("readable",E.bind(null,A)),A};return He=T,He}var Ve,$t;function ai(){return $t||($t=1,Ve=function(){throw new Error("Readable.from is not available in the browser")}),Ve}const gt=de;gt.Readable=F;F.ReadableState=br;hr.EventEmitter;var mr=function(e,r){return e.listeners(r).length},me=dr,Ne=he.Buffer,ui=re.Uint8Array||function(){};function li(t){return Ne.from(t)}function fi(t){return Ne.isBuffer(t)||t instanceof ui}var Ge=tr,M;Ge&&Ge.debuglog?M=Ge.debuglog("stream"):M=function(){};var ci=Gn(),yt=pr,hi=yr,di=hi.getHighWaterMark,Me=ie.codes,pi=Me.ERR_INVALID_ARG_TYPE,gi=Me.ERR_STREAM_PUSH_AFTER_EOF,yi=Me.ERR_METHOD_NOT_IMPLEMENTED,_i=Me.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,le,Ye,Ke;we(F,me);var ge=yt.errorOrDestroy,ze=["error","close","destroy","pause","resume"];function wi(t,e,r){if(typeof t.prependListener=="function")return t.prependListener(e,r);!t._events||!t._events[e]?t.on(e,r):Array.isArray(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]}function br(t,e,r){t=t||{},typeof r!="boolean"&&(r=e instanceof gt.Duplex),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=di(this,t,"readableHighWaterMark",r),this.buffer=new ci,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=t.emitClose!==!1,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(le||(le=_r().StringDecoder),this.decoder=new le(t.encoding),this.encoding=t.encoding)}function F(t){if(!(this instanceof F))return new F(t);var e=this instanceof gt.Duplex;this._readableState=new br(t,this,e),this.readable=!0,t&&(typeof t.read=="function"&&(this._read=t.read),typeof t.destroy=="function"&&(this._destroy=t.destroy)),me.call(this)}Object.defineProperty(F.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}});F.prototype.destroy=yt.destroy;F.prototype._undestroy=yt.undestroy;F.prototype._destroy=function(t,e){e(t)};F.prototype.push=function(t,e){var r=this._readableState,s;return r.objectMode?s=!0:typeof t=="string"&&(e=e||r.defaultEncoding,e!==r.encoding&&(t=Ne.from(t,e),e=""),s=!0),Er(this,t,e,!1,s)};F.prototype.unshift=function(t){return Er(this,t,null,!0,!1)};function Er(t,e,r,s,a){M("readableAddChunk",e);var f=t._readableState;if(e===null)f.reading=!1,Ei(t,f);else{var c;if(a||(c=mi(f,e)),c)ge(t,c);else if(f.objectMode||e&&e.length>0)if(typeof e!="string"&&!f.objectMode&&Object.getPrototypeOf(e)!==Ne.prototype&&(e=li(e)),s)f.endEmitted?ge(t,new _i):Je(t,f,e,!0);else if(f.ended)ge(t,new gi);else{if(f.destroyed)return!1;f.reading=!1,f.decoder&&!r?(e=f.decoder.write(e),f.objectMode||e.length!==0?Je(t,f,e,!1):ft(t,f)):Je(t,f,e,!1)}else s||(f.reading=!1,ft(t,f))}return!f.ended&&(f.length<f.highWaterMark||f.length===0)}function Je(t,e,r,s){e.flowing&&e.length===0&&!e.sync?(e.awaitDrain=0,t.emit("data",r)):(e.length+=e.objectMode?1:r.length,s?e.buffer.unshift(r):e.buffer.push(r),e.needReadable&&Be(t)),ft(t,e)}function mi(t,e){var r;return!fi(e)&&typeof e!="string"&&e!==void 0&&!t.objectMode&&(r=new pi("chunk",["string","Buffer","Uint8Array"],e)),r}F.prototype.isPaused=function(){return this._readableState.flowing===!1};F.prototype.setEncoding=function(t){le||(le=_r().StringDecoder);var e=new le(t);this._readableState.decoder=e,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,s="";r!==null;)s+=e.write(r.data),r=r.next;return this._readableState.buffer.clear(),s!==""&&this._readableState.buffer.push(s),this._readableState.length=s.length,this};var qt=1073741824;function bi(t){return t>=qt?t=qt:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}function Wt(t,e){return t<=0||e.length===0&&e.ended?0:e.objectMode?1:t!==t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=bi(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}F.prototype.read=function(t){M("read",t),t=parseInt(t,10);var e=this._readableState,r=t;if(t!==0&&(e.emittedReadable=!1),t===0&&e.needReadable&&((e.highWaterMark!==0?e.length>=e.highWaterMark:e.length>0)||e.ended))return M("read: emitReadable",e.length,e.ended),e.length===0&&e.ended?Xe(this):Be(this),null;if(t=Wt(t,e),t===0&&e.ended)return e.length===0&&Xe(this),null;var s=e.needReadable;M("need readable",s),(e.length===0||e.length-t<e.highWaterMark)&&(s=!0,M("length less than watermark",s)),e.ended||e.reading?(s=!1,M("reading or ended",s)):s&&(M("do read"),e.reading=!0,e.sync=!0,e.length===0&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=Wt(r,e)));var a;return t>0?a=Cr(t,e):a=null,a===null?(e.needReadable=e.length<=e.highWaterMark,t=0):(e.length-=t,e.awaitDrain=0),e.length===0&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&Xe(this)),a!==null&&this.emit("data",a),a};function Ei(t,e){if(M("onEofChunk"),!e.ended){if(e.decoder){var r=e.decoder.end();r&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length)}e.ended=!0,e.sync?Be(t):(e.needReadable=!1,e.emittedReadable||(e.emittedReadable=!0,Rr(t)))}}function Be(t){var e=t._readableState;M("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(M("emitReadable",e.flowing),e.emittedReadable=!0,process.nextTick(Rr,t))}function Rr(t){var e=t._readableState;M("emitReadable_",e.destroyed,e.length,e.ended),!e.destroyed&&(e.length||e.ended)&&(t.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,_t(t)}function ft(t,e){e.readingMore||(e.readingMore=!0,process.nextTick(Ri,t,e))}function Ri(t,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&e.length===0);){var r=e.length;if(M("maybeReadMore read 0"),t.read(0),r===e.length)break}e.readingMore=!1}F.prototype._read=function(t){ge(this,new yi("_read()"))};F.prototype.pipe=function(t,e){var r=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=t;break;case 1:s.pipes=[s.pipes,t];break;default:s.pipes.push(t);break}s.pipesCount+=1,M("pipe count=%d opts=%j",s.pipesCount,e);var a=(!e||e.end!==!1)&&t!==process.stdout&&t!==process.stderr,f=a?l:v;s.endEmitted?process.nextTick(f):r.once("end",f),t.on("unpipe",c);function c(T,d){M("onunpipe"),T===r&&d&&d.hasUnpiped===!1&&(d.hasUnpiped=!0,g())}function l(){M("onend"),t.end()}var w=vi(r);t.on("drain",w);var m=!1;function g(){M("cleanup"),t.removeListener("close",C),t.removeListener("finish",R),t.removeListener("drain",w),t.removeListener("error",E),t.removeListener("unpipe",c),r.removeListener("end",l),r.removeListener("end",v),r.removeListener("data",y),m=!0,s.awaitDrain&&(!t._writableState||t._writableState.needDrain)&&w()}r.on("data",y);function y(T){M("ondata");var d=t.write(T);M("dest.write",d),d===!1&&((s.pipesCount===1&&s.pipes===t||s.pipesCount>1&&Sr(s.pipes,t)!==-1)&&!m&&(M("false write response, pause",s.awaitDrain),s.awaitDrain++),r.pause())}function E(T){M("onerror",T),v(),t.removeListener("error",E),mr(t,"error")===0&&ge(t,T)}wi(t,"error",E);function C(){t.removeListener("finish",R),v()}t.once("close",C);function R(){M("onfinish"),t.removeListener("close",C),v()}t.once("finish",R);function v(){M("unpipe"),r.unpipe(t)}return t.emit("pipe",r),s.flowing||(M("pipe resume"),r.resume()),t};function vi(t){return function(){var r=t._readableState;M("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&mr(t,"data")&&(r.flowing=!0,_t(t))}}F.prototype.unpipe=function(t){var e=this._readableState,r={hasUnpiped:!1};if(e.pipesCount===0)return this;if(e.pipesCount===1)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,r),this);if(!t){var s=e.pipes,a=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var f=0;f<a;f++)s[f].emit("unpipe",this,{hasUnpiped:!1});return this}var c=Sr(e.pipes,t);return c===-1?this:(e.pipes.splice(c,1),e.pipesCount-=1,e.pipesCount===1&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,r),this)};F.prototype.on=function(t,e){var r=me.prototype.on.call(this,t,e),s=this._readableState;return t==="data"?(s.readableListening=this.listenerCount("readable")>0,s.flowing!==!1&&this.resume()):t==="readable"&&!s.endEmitted&&!s.readableListening&&(s.readableListening=s.needReadable=!0,s.flowing=!1,s.emittedReadable=!1,M("on readable",s.length,s.reading),s.length?Be(this):s.reading||process.nextTick(Ci,this)),r};F.prototype.addListener=F.prototype.on;F.prototype.removeListener=function(t,e){var r=me.prototype.removeListener.call(this,t,e);return t==="readable"&&process.nextTick(vr,this),r};F.prototype.removeAllListeners=function(t){var e=me.prototype.removeAllListeners.apply(this,arguments);return(t==="readable"||t===void 0)&&process.nextTick(vr,this),e};function vr(t){var e=t._readableState;e.readableListening=t.listenerCount("readable")>0,e.resumeScheduled&&!e.paused?e.flowing=!0:t.listenerCount("data")>0&&t.resume()}function Ci(t){M("readable nexttick read 0"),t.read(0)}F.prototype.resume=function(){var t=this._readableState;return t.flowing||(M("resume"),t.flowing=!t.readableListening,Si(this,t)),t.paused=!1,this};function Si(t,e){e.resumeScheduled||(e.resumeScheduled=!0,process.nextTick(Ti,t,e))}function Ti(t,e){M("resume",e.reading),e.reading||t.read(0),e.resumeScheduled=!1,t.emit("resume"),_t(t),e.flowing&&!e.reading&&t.read(0)}F.prototype.pause=function(){return M("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(M("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function _t(t){var e=t._readableState;for(M("flow",e.flowing);e.flowing&&t.read()!==null;);}F.prototype.wrap=function(t){var e=this,r=this._readableState,s=!1;t.on("end",function(){if(M("wrapped end"),r.decoder&&!r.ended){var c=r.decoder.end();c&&c.length&&e.push(c)}e.push(null)}),t.on("data",function(c){if(M("wrapped data"),r.decoder&&(c=r.decoder.write(c)),!(r.objectMode&&c==null)&&!(!r.objectMode&&(!c||!c.length))){var l=e.push(c);l||(s=!0,t.pause())}});for(var a in t)this[a]===void 0&&typeof t[a]=="function"&&(this[a]=function(l){return function(){return t[l].apply(t,arguments)}}(a));for(var f=0;f<ze.length;f++)t.on(ze[f],this.emit.bind(this,ze[f]));return this._read=function(c){M("wrapped _read",c),s&&(s=!1,t.resume())},this};typeof Symbol=="function"&&(F.prototype[Symbol.asyncIterator]=function(){return Ye===void 0&&(Ye=oi()),Ye(this)});Object.defineProperty(F.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}});Object.defineProperty(F.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}});Object.defineProperty(F.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}});F._fromList=Cr;Object.defineProperty(F.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function Cr(t,e){if(e.length===0)return null;var r;return e.objectMode?r=e.buffer.shift():!t||t>=e.length?(e.decoder?r=e.buffer.join(""):e.buffer.length===1?r=e.buffer.first():r=e.buffer.concat(e.length),e.buffer.clear()):r=e.buffer.consume(t,e.decoder),r}function Xe(t){var e=t._readableState;M("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,process.nextTick(xi,e,t))}function xi(t,e){if(M("endReadableNT",t.endEmitted,t.length),!t.endEmitted&&t.length===0&&(t.endEmitted=!0,e.readable=!1,e.emit("end"),t.autoDestroy)){var r=e._writableState;(!r||r.autoDestroy&&r.finished)&&e.destroy()}}typeof Symbol=="function"&&(F.from=function(t,e){return Ke===void 0&&(Ke=ai()),Ke(F,t,e)});function Sr(t,e){for(var r=0,s=t.length;r<s;r++)if(t[r]===e)return r;return-1}var Ai=Ii;function Ii(t,e){if(Ze("noDeprecation"))return t;var r=!1;function s(){if(!r){if(Ze("throwDeprecation"))throw new Error(e);Ze("traceDeprecation")?console.trace(e):console.warn(e),r=!0}return t.apply(this,arguments)}return s}function Ze(t){try{if(!re.localStorage)return!1}catch{return!1}var e=re.localStorage[t];return e==null?!1:String(e).toLowerCase()==="true"}const wt=de;wt.Writable=P;function Tr(t){var e=this;this.next=null,this.entry=null,this.finish=function(){rs(e,t)}}P.WritableState=be;var Ni={deprecate:Ai},xr=dr,Fe=he.Buffer,Mi=re.Uint8Array||function(){};function Bi(t){return Fe.from(t)}function Fi(t){return Fe.isBuffer(t)||t instanceof Mi}var mt=pr,Li=yr,ki=Li.getHighWaterMark,ee=ie.codes,Oi=ee.ERR_INVALID_ARG_TYPE,Di=ee.ERR_METHOD_NOT_IMPLEMENTED,Ui=ee.ERR_MULTIPLE_CALLBACK,Pi=ee.ERR_STREAM_CANNOT_PIPE,ji=ee.ERR_STREAM_DESTROYED,$i=ee.ERR_STREAM_NULL_VALUES,qi=ee.ERR_STREAM_WRITE_AFTER_END,Wi=ee.ERR_UNKNOWN_ENCODING,fe=mt.errorOrDestroy;we(P,xr);function Hi(){}function be(t,e,r){t=t||{},typeof r!="boolean"&&(r=e instanceof wt.Duplex),this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=ki(this,t,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var s=t.decodeStrings===!1;this.decodeStrings=!s,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(a){Xi(e,a)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=t.emitClose!==!1,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new Tr(this)}be.prototype.getBuffer=function(){for(var e=this.bufferedRequest,r=[];e;)r.push(e),e=e.next;return r};(function(){try{Object.defineProperty(be.prototype,"buffer",{get:Ni.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var Se;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Se=Function.prototype[Symbol.hasInstance],Object.defineProperty(P,Symbol.hasInstance,{value:function(e){return Se.call(this,e)?!0:this!==P?!1:e&&e._writableState instanceof be}})):Se=function(e){return e instanceof this};function P(t){var e=this instanceof wt.Duplex;if(!e&&!Se.call(P,this))return new P(t);this._writableState=new be(t,this,e),this.writable=!0,t&&(typeof t.write=="function"&&(this._write=t.write),typeof t.writev=="function"&&(this._writev=t.writev),typeof t.destroy=="function"&&(this._destroy=t.destroy),typeof t.final=="function"&&(this._final=t.final)),xr.call(this)}P.prototype.pipe=function(){fe(this,new Pi)};function Vi(t,e){var r=new qi;fe(t,r),process.nextTick(e,r)}function Gi(t,e,r,s){var a;return r===null?a=new $i:typeof r!="string"&&!e.objectMode&&(a=new Oi("chunk",["string","Buffer"],r)),a?(fe(t,a),process.nextTick(s,a),!1):!0}P.prototype.write=function(t,e,r){var s=this._writableState,a=!1,f=!s.objectMode&&Fi(t);return f&&!Fe.isBuffer(t)&&(t=Bi(t)),typeof e=="function"&&(r=e,e=null),f?e="buffer":e||(e=s.defaultEncoding),typeof r!="function"&&(r=Hi),s.ending?Vi(this,r):(f||Gi(this,s,t,r))&&(s.pendingcb++,a=Ki(this,s,f,t,e,r)),a};P.prototype.cork=function(){this._writableState.corked++};P.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,!t.writing&&!t.corked&&!t.bufferProcessing&&t.bufferedRequest&&Ar(this,t))};P.prototype.setDefaultEncoding=function(e){if(typeof e=="string"&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new Wi(e);return this._writableState.defaultEncoding=e,this};Object.defineProperty(P.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function Yi(t,e,r){return!t.objectMode&&t.decodeStrings!==!1&&typeof e=="string"&&(e=Fe.from(e,r)),e}Object.defineProperty(P.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function Ki(t,e,r,s,a,f){if(!r){var c=Yi(e,s,a);s!==c&&(r=!0,a="buffer",s=c)}var l=e.objectMode?1:s.length;e.length+=l;var w=e.length<e.highWaterMark;if(w||(e.needDrain=!0),e.writing||e.corked){var m=e.lastBufferedRequest;e.lastBufferedRequest={chunk:s,encoding:a,isBuf:r,callback:f,next:null},m?m.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else ct(t,e,!1,l,s,a,f);return w}function ct(t,e,r,s,a,f,c){e.writelen=s,e.writecb=c,e.writing=!0,e.sync=!0,e.destroyed?e.onwrite(new ji("write")):r?t._writev(a,e.onwrite):t._write(a,f,e.onwrite),e.sync=!1}function zi(t,e,r,s,a){--e.pendingcb,r?(process.nextTick(a,s),process.nextTick(ye,t,e),t._writableState.errorEmitted=!0,fe(t,s)):(a(s),t._writableState.errorEmitted=!0,fe(t,s),ye(t,e))}function Ji(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function Xi(t,e){var r=t._writableState,s=r.sync,a=r.writecb;if(typeof a!="function")throw new Ui;if(Ji(r),e)zi(t,r,s,e,a);else{var f=Ir(r)||t.destroyed;!f&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest&&Ar(t,r),s?process.nextTick(Ht,t,r,f,a):Ht(t,r,f,a)}}function Ht(t,e,r,s){r||Zi(t,e),e.pendingcb--,s(),ye(t,e)}function Zi(t,e){e.length===0&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}function Ar(t,e){e.bufferProcessing=!0;var r=e.bufferedRequest;if(t._writev&&r&&r.next){var s=e.bufferedRequestCount,a=new Array(s),f=e.corkedRequestsFree;f.entry=r;for(var c=0,l=!0;r;)a[c]=r,r.isBuf||(l=!1),r=r.next,c+=1;a.allBuffers=l,ct(t,e,!0,e.length,a,"",f.finish),e.pendingcb++,e.lastBufferedRequest=null,f.next?(e.corkedRequestsFree=f.next,f.next=null):e.corkedRequestsFree=new Tr(e),e.bufferedRequestCount=0}else{for(;r;){var w=r.chunk,m=r.encoding,g=r.callback,y=e.objectMode?1:w.length;if(ct(t,e,!1,y,w,m,g),r=r.next,e.bufferedRequestCount--,e.writing)break}r===null&&(e.lastBufferedRequest=null)}e.bufferedRequest=r,e.bufferProcessing=!1}P.prototype._write=function(t,e,r){r(new Di("_write()"))};P.prototype._writev=null;P.prototype.end=function(t,e,r){var s=this._writableState;return typeof t=="function"?(r=t,t=null,e=null):typeof e=="function"&&(r=e,e=null),t!=null&&this.write(t,e),s.corked&&(s.corked=1,this.uncork()),s.ending||ts(this,s,r),this};Object.defineProperty(P.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Ir(t){return t.ending&&t.length===0&&t.bufferedRequest===null&&!t.finished&&!t.writing}function Qi(t,e){t._final(function(r){e.pendingcb--,r&&fe(t,r),e.prefinished=!0,t.emit("prefinish"),ye(t,e)})}function es(t,e){!e.prefinished&&!e.finalCalled&&(typeof t._final=="function"&&!e.destroyed?(e.pendingcb++,e.finalCalled=!0,process.nextTick(Qi,t,e)):(e.prefinished=!0,t.emit("prefinish")))}function ye(t,e){var r=Ir(e);if(r&&(es(t,e),e.pendingcb===0&&(e.finished=!0,t.emit("finish"),e.autoDestroy))){var s=t._readableState;(!s||s.autoDestroy&&s.endEmitted)&&t.destroy()}return r}function ts(t,e,r){e.ending=!0,ye(t,e),r&&(e.finished?process.nextTick(r):t.once("finish",r)),e.ended=!0,t.writable=!1}function rs(t,e,r){var s=t.entry;for(t.entry=null;s;){var a=s.callback;e.pendingcb--,a(r),s=s.next}e.corkedRequestsFree.next=t}Object.defineProperty(P.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}});P.prototype.destroy=mt.destroy;P.prototype._undestroy=mt.undestroy;P.prototype._destroy=function(t,e){e(t)};var ns=Object.keys||function(t){var e=[];for(var r in t)e.push(r);return e};const ce=de;ce.Duplex=z;we(z,ce.Readable);for(var Vt=ns(ce.Writable.prototype),Qe=0;Qe<Vt.length;Qe++){var et=Vt[Qe];z.prototype[et]||(z.prototype[et]=ce.Writable.prototype[et])}function z(t){if(!(this instanceof z))return new z(t);ce.Readable.call(this,t),ce.Writable.call(this,t),this.allowHalfOpen=!0,t&&(t.readable===!1&&(this.readable=!1),t.writable===!1&&(this.writable=!1),t.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",is)))}Object.defineProperty(z.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});Object.defineProperty(z.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});Object.defineProperty(z.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function is(){this._writableState.ended||process.nextTick(ss,this)}function ss(t){t.end()}Object.defineProperty(z.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(e){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=e,this._writableState.destroyed=e)}});const Ee=de;Ee.Transform=Z;var Le=ie.codes,os=Le.ERR_METHOD_NOT_IMPLEMENTED,as=Le.ERR_MULTIPLE_CALLBACK,us=Le.ERR_TRANSFORM_ALREADY_TRANSFORMING,ls=Le.ERR_TRANSFORM_WITH_LENGTH_0;we(Z,Ee.Duplex);function fs(t,e){var r=this._transformState;r.transforming=!1;var s=r.writecb;if(s===null)return this.emit("error",new as);r.writechunk=null,r.writecb=null,e!=null&&this.push(e),s(t);var a=this._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}function Z(t){if(!(this instanceof Z))return new Z(t);Ee.Duplex.call(this,t),this._transformState={afterTransform:fs.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&(typeof t.transform=="function"&&(this._transform=t.transform),typeof t.flush=="function"&&(this._flush=t.flush)),this.on("prefinish",cs)}function cs(){var t=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,r){Gt(t,e,r)}):Gt(this,null,null)}Z.prototype.push=function(t,e){return this._transformState.needTransform=!1,Ee.Duplex.prototype.push.call(this,t,e)};Z.prototype._transform=function(t,e,r){r(new os("_transform()"))};Z.prototype._write=function(t,e,r){var s=this._transformState;if(s.writecb=r,s.writechunk=t,s.writeencoding=e,!s.transforming){var a=this._readableState;(s.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}};Z.prototype._read=function(t){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};Z.prototype._destroy=function(t,e){Ee.Duplex.prototype._destroy.call(this,t,function(r){e(r)})};function Gt(t,e,r){if(e)return t.emit("error",e);if(r!=null&&t.push(r),t._writableState.length)throw new ls;if(t._transformState.transforming)throw new us;return t.push(null)}const Nr=de;Nr.PassThrough=_e;we(_e,Nr.Transform);function _e(t){if(!(this instanceof _e))return new _e(t);Transform.call(this,t)}_e.prototype._transform=function(t,e,r){r(null,t)};var tt;function hs(t){var e=!1;return function(){e||(e=!0,t.apply(void 0,arguments))}}var Mr=ie.codes,ds=Mr.ERR_MISSING_ARGS,ps=Mr.ERR_STREAM_DESTROYED;function Yt(t){if(t)throw t}function gs(t){return t.setHeader&&typeof t.abort=="function"}function ys(t,e,r,s){s=hs(s);var a=!1;t.on("close",function(){a=!0}),tt===void 0&&(tt=pt),tt(t,{readable:e,writable:r},function(c){if(c)return s(c);a=!0,s()});var f=!1;return function(c){if(!a&&!f){if(f=!0,gs(t))return t.abort();if(typeof t.destroy=="function")return t.destroy();s(c||new ps("pipe"))}}}function Kt(t){t()}function _s(t,e){return t.pipe(e)}function ws(t){return!t.length||typeof t[t.length-1]!="function"?Yt:t.pop()}function ms(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var s=ws(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new ds("streams");var a,f=e.map(function(c,l){var w=l<e.length-1,m=l>0;return ys(c,w,m,function(g){a||(a=g),g&&f.forEach(Kt),!w&&(f.forEach(Kt),s(a))})});return e.reduce(_s)}var bs=ms;(function(t,e){const r=de;e=t.exports=r.Readable,e.Stream=r.Readable,e.Readable=r.Readable,e.Writable=r.Writable,e.Duplex=r.Duplex,e.Transform=r.Transform,e.PassThrough=r.PassThrough,e.finished=pt,e.pipeline=bs})(at,at.exports);var Es=at.exports;/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let zt;var Rs=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:re):t=>(zt||(zt=Promise.resolve())).then(t).catch(e=>setTimeout(()=>{throw e},0));function Jt(t,e){for(const r in e)Object.defineProperty(t,r,{value:e[r],enumerable:!0,configurable:!0});return t}function vs(t,e,r){if(!t||typeof t=="string")throw new TypeError("Please pass an Error to err-code");r||(r={}),typeof e=="object"&&(r=e,e=""),e&&(r.code=e);try{return Jt(t,r)}catch{r.message=t.message,r.stack=t.stack;const a=function(){};return a.prototype=Object.create(Object.getPrototypeOf(t)),Jt(new a,r)}}var Cs=vs;/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const Ss=Sn("simple-peer"),Br=Tn,Xt=Pn,Ts=Es,rt=Rs,B=Cs,{Buffer:xs}=he,nt=64*1024,As=5*1e3,Is=5*1e3;function Zt(t){return t.replace(/a=ice-options:trickle\s\n/g,"")}function Ns(t){console.warn(t)}class ne extends Ts.Duplex{constructor(e){if(e=Object.assign({allowHalfOpen:!1},e),super(e),this._id=Xt(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||Xt(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||ne.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},ne.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(r=>r),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||As,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&typeof e.wrtc=="object"?e.wrtc:Br(),!this._wrtc)throw B(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(r){this.destroy(B(r,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=r=>{this._onIceCandidate(r)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(r=>{this.destroy(B(r,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=r=>{this._setupData(r)},this.streams&&this.streams.forEach(r=>{this.addStream(r)}),this._pc.ontrack=r=>{this._onTrack(r)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw B(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(r=>{this._addIceCandidate(r)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(r=>{this.destroy(B(r,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.destroy(B(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const r=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(r).catch(s=>{!r.address||r.address.endsWith(".local")?Ns("Ignoring unsupported ICE candidate."):this.destroy(B(s,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this.destroying){if(this.destroyed)throw B(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,r){if(!this.destroying){if(this.destroyed)throw B(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,r),this._needsNegotiation()}catch(s){this.destroy(B(s,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:r}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw B(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(r=>{this.addTrack(r,e)})}}addTrack(e,r){if(this.destroying)return;if(this.destroyed)throw B(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const s=this._senderMap.get(e)||new Map;let a=s.get(r);if(!a)a=this._pc.addTrack(e,r),s.set(r,a),this._senderMap.set(e,s),this._needsNegotiation();else throw a.removed?B(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):B(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,r,s){if(this.destroying)return;if(this.destroyed)throw B(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const a=this._senderMap.get(e),f=a?a.get(s):null;if(!f)throw B(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");r&&this._senderMap.set(r,a),f.replaceTrack!=null?f.replaceTrack(r):this.destroy(B(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,r){if(this.destroying)return;if(this.destroyed)throw B(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const s=this._senderMap.get(e),a=s?s.get(r):null;if(!a)throw B(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{a.removed=!0,this._pc.removeTrack(a)}catch(f){f.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(a):this.destroy(B(f,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw B(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(r=>{this.removeTrack(r,e)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,rt(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw B(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this._destroy(e,()=>{})}_destroy(e,r){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),rt(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),r()}))}_setupData(e){if(!e.channel)return this.destroy(B(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=nt),this.channelName=this._channel.label,this._channel.onmessage=s=>{this._onChannelMessage(s)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=s=>{const a=s.error instanceof Error?s.error:new Error(`Datachannel error: ${s.message} ${s.filename}:${s.lineno}:${s.colno}`);this.destroy(B(a,"ERR_DATA_CHANNEL"))};let r=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(r&&this._onChannelClose(),r=!0):r=!1},Is)}_read(){}_write(e,r,s){if(this.destroyed)return s(B(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(a){return this.destroy(B(a,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>nt?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=s):s(null)}else this._debug("write before connect"),this._chunk=e,this._cb=s}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Zt(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const r=()=>{if(this.destroyed)return;const f=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:f.type,sdp:f.sdp})},s=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?r():this.once("_iceComplete",r))},a=f=>{this.destroy(B(f,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(s).catch(a)}).catch(e=>{this.destroy(B(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=Zt(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const r=()=>{if(this.destroyed)return;const f=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:f.type,sdp:f.sdp}),this.initiator||this._requestMissingTransceivers()},s=()=>{this.destroyed||(this.trickle||this._iceComplete?r():this.once("_iceComplete",r))},a=f=>{this.destroy(B(f,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(s).catch(a)}).catch(e=>{this.destroy(B(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(B(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,r=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,r),this.emit("iceStateChange",e,r),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.destroy(B(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.destroy(B(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const r=s=>(Object.prototype.toString.call(s.values)==="[object Array]"&&s.values.forEach(a=>{Object.assign(s,a)}),s);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(s=>{const a=[];s.forEach(f=>{a.push(r(f))}),e(null,a)},s=>e(s)):this._pc.getStats.length>0?this._pc.getStats(s=>{if(this.destroyed)return;const a=[];s.result().forEach(f=>{const c={};f.names().forEach(l=>{c[l]=f.stat(l)}),c.id=f.id,c.type=f.type,c.timestamp=f.timestamp,a.push(r(c))}),e(null,a)},s=>e(s)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats((r,s)=>{if(this.destroyed)return;r&&(s=[]);const a={},f={},c={};let l=!1;s.forEach(m=>{(m.type==="remotecandidate"||m.type==="remote-candidate")&&(a[m.id]=m),(m.type==="localcandidate"||m.type==="local-candidate")&&(f[m.id]=m),(m.type==="candidatepair"||m.type==="candidate-pair")&&(c[m.id]=m)});const w=m=>{l=!0;let g=f[m.localCandidateId];g&&(g.ip||g.address)?(this.localAddress=g.ip||g.address,this.localPort=Number(g.port)):g&&g.ipAddress?(this.localAddress=g.ipAddress,this.localPort=Number(g.portNumber)):typeof m.googLocalAddress=="string"&&(g=m.googLocalAddress.split(":"),this.localAddress=g[0],this.localPort=Number(g[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let y=a[m.remoteCandidateId];y&&(y.ip||y.address)?(this.remoteAddress=y.ip||y.address,this.remotePort=Number(y.port)):y&&y.ipAddress?(this.remoteAddress=y.ipAddress,this.remotePort=Number(y.portNumber)):typeof m.googRemoteAddress=="string"&&(y=m.googRemoteAddress.split(":"),this.remoteAddress=y[0],this.remotePort=Number(y[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(s.forEach(m=>{m.type==="transport"&&m.selectedCandidatePairId&&w(c[m.selectedCandidatePairId]),(m.type==="googCandidatePair"&&m.googActiveConnection==="true"||(m.type==="candidatepair"||m.type==="candidate-pair")&&m.selected)&&w(m)}),!l&&(!Object.keys(c).length||Object.keys(f).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(g){return this.destroy(B(g,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const m=this._cb;this._cb=null,m(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>nt||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let r=e.data;r instanceof ArrayBuffer&&(r=xs.from(r)),this.push(r)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach(r=>{this._debug("on track"),this.emit("track",e.track,r),this._remoteTracks.push({track:e.track,stream:r}),!this._remoteStreams.some(s=>s.id===r.id)&&(this._remoteStreams.push(r),rt(()=>{this._debug("on stream"),this.emit("stream",r)}))})}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],Ss.apply(null,e)}}ne.WEBRTC_SUPPORT=!!Br();ne.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};ne.channelConfig={};var Ms=ne;const Qt=Xr(Ms);function Bs({user:t,onSendMessage:e,chat_data:r}){const[s,a]=Te.useState(""),f=l=>{a(l.target.value)},c=l=>{l.preventDefault(),s.trim()&&(e({from:t.user_id,content:s}),a(""))};return x.jsx("div",{className:"conference-chat-container",children:x.jsxs("div",{className:"card",children:[x.jsx("div",{className:"px-1",children:r.messages.map((l,w)=>x.jsx(En,{message:l,active_me:t.user_id===l.author.user_id},w))}),x.jsx("div",{children:x.jsx("form",{className:"form-group px-3",onSubmit:c,children:x.jsxs("div",{className:"input-group mb-3",children:[x.jsx("input",{type:"text",placeholder:"Message...",className:"form-control",value:s,onChange:f}),x.jsx("div",{className:"input-group-append",children:x.jsx("button",{type:"submit",className:"btn btn-send-message",children:x.jsx(X,{path:Zr,size:1})})})]})})})]})})}const Fs=(t,e,r=300)=>{const[s,a]=te.useState(0),f=te.useRef(null);return te.useEffect(()=>(s===1?f.current=setTimeout(()=>{a(0),e()},r):s===2&&(clearTimeout(f.current),a(0),t()),()=>{f.current&&clearTimeout(f.current)}),[s,e,t,r]),()=>{a(l=>l+1)}};const er=({peer:t,user:e,isLocalUser:r,className:s,onClick:a,onDoubleClick:f,stream:c})=>{const[l,w]=te.useState(!1),m=te.useRef(null),g=()=>{w(!0)},y=()=>{w(!1)};te.useEffect(()=>{t&&e&&!r&&t.on("stream",C=>{m.current.srcObject=C})},[t,e,r]);const E=Fs(()=>{f()},()=>{a()});return te.useEffect(()=>{r&&c!=null&&(m.current.srcObject=c)},[r,c]),x.jsxs("div",{className:`video-participant ${s||""}`,onMouseOver:g,onMouseOut:y,onClick:E,children:[x.jsx("a",{href:"#",className:"video-participant__username",children:e?e.user_full_name:"Anonymous"}),x.jsx("video",{ref:m,autoPlay:!0,muted:r})]})};const Ls=(t,e)=>({...e}),ks={openModal:cn},Os=Qr(Ls,ks);class Ds extends Te.Component{constructor(r){super(r);$(this,"websocketRef");$(this,"muteVideo",()=>{const r=this.state.stream;r.getVideoTracks()[0]&&(r.getVideoTracks()[0].enabled=!r.getVideoTracks()[0].enabled,this.setState(s=>{const a={...s.currentUserStreamSettings};return a.isVideoMuted=!r.getVideoTracks()[0].enabled,{currentUserStreamSettings:a}}))});$(this,"muteAudio",()=>{const r=this.state.stream;r.getAudioTracks()[0]&&(r.getAudioTracks()[0].enabled=!r.getAudioTracks()[0].enabled,this.setState(s=>{const a={...s.currentUserStreamSettings};return a.isAudioMuted=!r.getAudioTracks()[0].enabled,{currentUserStreamSettings:a}}))});$(this,"leaveRoom",()=>{this.props.onLeave()});$(this,"createPeer",(r,s,a)=>{const f=new Qt({initiator:!0,trickle:!1,stream:a});return f.on("signal",c=>{this.websocketRef.current.send(JSON.stringify({type:"sending_offer",data:{from:r,to:s,offer:c}}))}),f});$(this,"addPeer",(r,s,a,f)=>{const c=new Qt({initiator:!1,trickle:!1,stream:f});return c.signal(a),c.on("signal",l=>{this.websocketRef.current.send(JSON.stringify({type:"sending_answer",data:{from:r,to:s,answer:l}}))}),c});$(this,"sendSignalsToAll",(r,s)=>{const a=[];this.state.usersConnected.forEach(f=>{if(f.user_id!==r.user_id){const c=this.createPeer(r,f,s);a.push({user:f,peer:c})}}),this.setState({peersEstablished:a})});$(this,"componentDidMount",()=>{var w;const{conference_payload:r,printFeedback:s,intl:a}=this.props,{current_user_data:f}=this.state;if(this.websocketRef.current&&((w=this.websocketRef.current)==null?void 0:w.readyState)===1)return;if(!navigator.mediaDevices){this.setState({isVideoRoomAccessible:!1}),s({type:"error",feedbackMsg:"this video room is not accessible because the site is not running on secure protocol, i.e. 'HTTPS'"});return}const c=en.getCurrentAccessToken(),l=new WebSocket(`wss://www.smedufacelearn.kz/ws/conference/${r.id}/?token=${c}`);this.websocketRef.current=l,l.onopen=()=>{this.setState({contentLoading:!0}),l.send(JSON.stringify({type:"new_user_joined",data:{from:f,token:localStorage.getItem("access_token")}}))},l.onmessage=m=>{var C;const g=JSON.parse(m.data),y=g.from,E=(C=g.data)==null?void 0:C.to;switch(console.log("onmessage",g,y,E),g.type){case"new_user_joined":this.setState({usersConnected:g.users_connected}),f.user_id===y.user_id?navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(R=>{this.setState({stream:R}),this.sendSignalsToAll(f,R)}).catch(R=>{this.setState({isVideoRoomAccessible:!1}),s({type:"error",feedbackMsg:"you need to enable media devices inorder to use access this room"})}):s({type:"success",feedbackMsg:`${y.user_full_name} joined this room`});break;case"sending_offer":if(f.user_id===E.user_id){const R=this.addPeer(f,y,g.data.offer,this.state.stream);this.setState(({peersEstablished:v})=>{let T=[...v,{user:y,peer:R}];const d=this.state.peersEstablished.find(b=>b.user.user_id===y.user_id);return d&&(T=[...v.filter(S=>d.user.user_id!==S.user.user_id),{user:y,peer:R}]),{peersEstablished:T}})}break;case"sending_answer":E.user_id===f.user_id&&this.state.peersEstablished.find(v=>v.user.user_id===y.user_id).peer.signal(g.data.answer);break;case"chat_message_new":this.setState(R=>{const v={author:y,content:g.data.content},T=[...R.chatData.messages];return T.push(v),{chatData:{messages:T,last_message:v}}});break;case"disconnected":if(y.user_id!==f.user_id&&y){s({type:"error",feedbackMsg:`${y.user_full_name} left`});const R=this.state.peersEstablished.find(v=>v.user.user_id===y.user_id);if(R){R.peer.destroy();const v=this.state.peersEstablished.filter(T=>R.user.user_id!==T.user.user_id);this.setState({peersEstablished:v})}}break;case"meeting_stop":s({type:"info",feedbackMsg:a.formatMessage({id:"conference.alert_session_stpped"})}),this.leaveRoom();break}},l.onclose=m=>{m.code>=4e3&&this.props.openModal({type:"error",data:{code:m.code,message:m.reason}})}});$(this,"componentWillUnmount",()=>{const{peersEstablished:r,stream:s}=this.state;this.websocketRef.current&&this.websocketRef.current.close(),r.forEach(({peer:a})=>{a.destroy()}),s&&s.getTracks().forEach(function(a){a.stop()}),this.setState({stream:null,usersConnected:[],peersEstablished:[],currentUserStreamSettings:{isAudioMuted:!1,isVideoMuted:!1,mainVideoId:null,isScreenSharing:!1}})});$(this,"getMedia",(r=!1)=>r?navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}):navigator.mediaDevices.getUserMedia({video:!0,audio:!0}));$(this,"handleScreenShare",()=>{const{currentUserStreamSettings:r,current_user_data:s,peersEstablished:a}=this.state;(async c=>{try{const l=await this.getMedia(c),w={...r};a.forEach(m=>{m.peer.addStream(l)}),w.isScreenSharing=c,this.setState({stream:l,currentUserStreamSettings:w})}catch(l){console.error("Error capturing screen:",l)}})(!r.isScreenSharing)});$(this,"handleOpenAsMain",r=>{this.setState(s=>{const a={...s.currentUserStreamSettings};return a.mainVideoId=r,{currentUserStreamSettings:a}})});$(this,"handleMainDoubleClick",()=>{const{currentUserStreamSettings:r}=this.state;r.mainVideoId!==null&&this.setState(s=>{const a={...s.currentUserStreamSettings};return a.mainVideoId=null,{currentUserStreamSettings:a}})});$(this,"handleToggleChatSidebar",()=>{const{isMobile:r}=this.props;r&&this.setState(s=>({isSidebarOpen:!s.isSidebarOpen}))});$(this,"handleSendChatData",(r,s={})=>{var a;((a=this.websocketRef.current)==null?void 0:a.readyState)===1&&this.websocketRef.current.send(JSON.stringify({type:r,data:s}))});$(this,"handleSendMessage",r=>{this.handleSendChatData("chat_message_new",r)});$(this,"stopMeeting",()=>{const{printFeedback:r,intl:s}=this.props;this.handleSendChatData("meeting_stop"),r({type:"error",feedbackMsg:s.formatMessage({id:"conference.alert_session_stpped"})})});const s={user_id:r.user.id,user_full_name:r.user.username};this.state={stream:null,usersConnected:[],peersEstablished:[],currentUserStreamSettings:{isVideoMuted:!1,isAudioMuted:!1,mainVideoId:null,isScreenSharing:!1},contentLoading:!0,isSidebarOpen:!1,isVideoRoomAccessible:!0,chatData:{messages:[],last_message:null},current_user_data:s},this.websocketRef=Te.createRef()}render(){const{isVideoRoomAccessible:r,currentUserStreamSettings:s,isSidebarOpen:a,peersEstablished:f,stream:c,chatData:l,current_user_data:w}=this.state,{conference_payload:m,isMobile:g}=this.props;return x.jsx("div",{className:"conference-room-container row p-0 m-0",children:x.jsx("div",{className:"col-12 p-0 m-0",children:x.jsxs("div",{className:"row p-0 m-0",children:[x.jsx("div",{className:"col-12 col-lg-9 p-0 m-0",children:r?x.jsxs(x.Fragment,{children:[x.jsxs("div",{className:"video-call-wrapper d-flex flex-wrap",children:[x.jsx(er,{isLocalUser:!0,stream:c,user:w,onClick:()=>this.handleOpenAsMain("localUser"),onDoubleClick:this.handleMainDoubleClick,className:s.mainVideoId==="localUser"?"main-video":""}),f.map((y,E)=>x.jsx(er,{isLocalUser:!1,user:y.user,peer:y.peer,onClick:()=>this.handleOpenAsMain(`remote-${y.user.user_id}`),onDoubleClick:this.handleMainDoubleClick,className:s.mainVideoId===`remote-${y.user.user_id}`?"main-video":""},E))]}),x.jsxs("div",{className:"video-call-actions",children:[x.jsx("button",{className:"video-action-button",onClick:this.muteAudio,children:s.isAudioMuted?x.jsx(X,{path:tn,size:1}):x.jsx(X,{path:rn,size:1})}),x.jsx("button",{className:"video-action-button",onClick:this.muteVideo,children:s.isVideoMuted?x.jsx(X,{path:nn,size:1}):x.jsx(X,{path:sn,size:1})}),x.jsx("button",{className:"video-action-button px-4",onClick:this.leaveRoom,children:x.jsx(Nt,{id:"leave"})}),x.jsx("button",{className:"video-action-button",onClick:this.handleScreenShare,children:s.isScreenSharing?x.jsx(X,{path:on,size:1}):x.jsx(X,{path:an,size:1})}),w.user_id===m.admin.id&&x.jsx("button",{className:"video-action-button px-4",onClick:this.stopMeeting,children:x.jsx(Nt,{id:"conference.stop_meeting"})})]})]}):x.jsx(un,{variant:"danger",className:"mt-3",children:"This room is not accessible. Please make sure you enabled your media devices."})}),x.jsx("button",{className:`btn-expand-chat-sidebar ${a?"":"show"}`,onClick:this.handleToggleChatSidebar,children:x.jsx(X,{path:ln,size:1})}),x.jsxs("div",{className:`chat-sidebar col-12 col-lg-3 p-0 ${a?"show":""}`,children:[x.jsx("button",{className:`btn-close-chat-sidebar ${a?"show":""}`,onClick:this.handleToggleChatSidebar,children:x.jsx(X,{path:fn,size:1})}),x.jsx(Bs,{user:w,chat_data:l,onSendMessage:this.handleSendMessage})]})]})})})}}const Us=Os(Ds);function Hs(){const t=hn(),e=dn(),r=pn(),{conference_payload:s,loading:a}=Mt(y=>y.conference),{user:f}=Mt(y=>y.auth),c=gn(),{id:l}=yn(),w=_n({maxWidth:900}),m=y=>{console.log("printFeedback",y);const E=y.type==="error"?"danger":y.type;c.show({headerContent:"Bootstrap",bodyContent:y.feedbackMsg,toastProps:{bg:E}})},g=()=>{e("/dashboard/conferences/")};return Te.useEffect(()=>{if(l&&!s&&t(wn(Number(l))),s&&s.status==="completed"){m({type:"info",feedbackMsg:r.formatMessage({id:"conference.alert_session_stpped"})});const y=setTimeout(()=>{e("/dashboard/conferences")},2e3);return()=>{y&&clearTimeout(y)}}},[t,l,s]),x.jsxs("main",{className:"conference-room-page flex-grow-1 bg-green-light",children:[x.jsx(mn,{title:r.formatMessage({id:"dashboard.Th4u/F"})}),x.jsx("section",{className:"clients w-100",children:x.jsx("div",{className:"container",children:!a.detail&&s?x.jsx(Us,{conference_payload:s,printFeedback:m,user:f,onLeave:g,intl:r,isMobile:w}):x.jsx(bn,{active:!0})})})]})}export{Hs as default};
